[ { "title": "Rust Receipe", "url": "/posts/rust-receipe/", "categories": "Rust", "tags": "Rust", "date": "2024-03-26 16:03:00 +0800", "snippet": "å¼€å¯Cargo Bench æˆªè‡³ç›®å‰(1.78)å¿…é¡»åœ¨nightlyç¯å¢ƒé‡Œä½¿ç”¨: rustup override set nightly åœ¨éœ€è¦ä½¿ç”¨benchçš„modé‡Œæ”¾ç½®ä¸‹é¢ä¸¤è¡Œä»£ç : #![feature(test)]extern crate test; benchä»£ç ç¤ºä¾‹: #[bench]fn bench(b: &amp;mut Ben...", "content": "å¼€å¯Cargo Bench æˆªè‡³ç›®å‰(1.78)å¿…é¡»åœ¨nightlyç¯å¢ƒé‡Œä½¿ç”¨: rustup override set nightly åœ¨éœ€è¦ä½¿ç”¨benchçš„modé‡Œæ”¾ç½®ä¸‹é¢ä¸¤è¡Œä»£ç : #![feature(test)]extern crate test; benchä»£ç ç¤ºä¾‹: #[bench]fn bench(b: &amp;mut Bencher){ b.iter(||{ ... })} æ¨¡æ‹Ÿå‡½æ•°é‡è½½Rustæ²¡æœ‰å‡½æ•°é‡è½½ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡Traitæ¥æ¨¡æ‹Ÿpub trait Foo&lt;Args&gt; { fn invoke(&amp;self, args: Args);}struct FooImpl;impl Foo&lt;i32&gt; for FooImpl { fn invoke(&amp;self, i: i32) { println!(\"i32: {}\", i); }}impl Foo&lt;String&gt; for FooImpl { fn invoke(&amp;self, s: String) { println!(\"String: {}\", s); }}impl Foo&lt;(i32, i64)&gt; for FooImpl { fn invoke(&amp;self, t: (i32, i64)) { println!(\"Tuple: {:?}\", t); }}impl Foo&lt;()&gt; for FooImpl { fn invoke(&amp;self, _: ()) { println!(\"Unit\"); }}#[cfg(test)]mod tests { use super::*; #[test] fn test() { let foo = FooImpl; foo.invoke(42); foo.invoke(\"Hello, World\".to_string()); foo.invoke((42, 62)); foo.invoke(()); }}" }, { "title": "Meltdownæ”»å‡»", "url": "/posts/meltdown/", "categories": "security", "tags": "", "date": "2024-03-03 17:13:00 +0800", "snippet": "ä»Šå¤©å’Œç¾¤å‹èŠå¤©çš„æ—¶å€™çŸ¥é“äº†Meltdown attack/spectreè¿™ç§å¥‡å¦™çš„ä¾§ä¿¡é“æ”»å‡»æ‰‹æ³•ã€‚åˆ©ç”¨è¿™ç§æ‰‹æ³•ï¼Œä»»æ„çš„è¿›ç¨‹éƒ½å¯ä»¥å¾—åˆ°ç‰©ç†å†…å­˜ä¸­çš„ä»»æ„å†…å®¹ï¼Œå¯ä»¥è½»æ˜“åœ°å¾—åˆ°å†…æ ¸ä¸­çš„æ•æ„Ÿä¿¡æ¯ã€‚ä»€ä¹ˆæ˜¯ä¾§ä¿¡é“æ”»å‡»ä»€ä¹ˆæ˜¯ä¾§ä¿¡é“æ”»å‡»ï¼Ÿä¾§ä¿¡é“æ˜¯æŒ‡ä½ çš„ç¨‹åºåœ¨æ­£å¸¸çš„é€šä¿¡æ¸ é“ä»¥å¤–ï¼Œäº§ç”Ÿäº†æŸäº›å…¶ä»–çš„ç‰¹å¾ï¼Œè€Œæ”»å‡»è€…ä»è¿™äº›ç‰¹é‡Œæ‹¿åˆ°äº†ä½ ä¸æƒ³æš´éœ²çš„ä¿¡æ¯ã€‚è¿™ä¸ªâ€œå…¶ä»–çš„ç‰¹å¾â€äº§ç”Ÿçš„ä¿¡æ¯é€šé“å°±æ˜¯ä¾§ä¿¡é“ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä½ æ­£åœ¨ç ´è§£ä¸€...", "content": "ä»Šå¤©å’Œç¾¤å‹èŠå¤©çš„æ—¶å€™çŸ¥é“äº†Meltdown attack/spectreè¿™ç§å¥‡å¦™çš„ä¾§ä¿¡é“æ”»å‡»æ‰‹æ³•ã€‚åˆ©ç”¨è¿™ç§æ‰‹æ³•ï¼Œä»»æ„çš„è¿›ç¨‹éƒ½å¯ä»¥å¾—åˆ°ç‰©ç†å†…å­˜ä¸­çš„ä»»æ„å†…å®¹ï¼Œå¯ä»¥è½»æ˜“åœ°å¾—åˆ°å†…æ ¸ä¸­çš„æ•æ„Ÿä¿¡æ¯ã€‚ä»€ä¹ˆæ˜¯ä¾§ä¿¡é“æ”»å‡»ä»€ä¹ˆæ˜¯ä¾§ä¿¡é“æ”»å‡»ï¼Ÿä¾§ä¿¡é“æ˜¯æŒ‡ä½ çš„ç¨‹åºåœ¨æ­£å¸¸çš„é€šä¿¡æ¸ é“ä»¥å¤–ï¼Œäº§ç”Ÿäº†æŸäº›å…¶ä»–çš„ç‰¹å¾ï¼Œè€Œæ”»å‡»è€…ä»è¿™äº›ç‰¹é‡Œæ‹¿åˆ°äº†ä½ ä¸æƒ³æš´éœ²çš„ä¿¡æ¯ã€‚è¿™ä¸ªâ€œå…¶ä»–çš„ç‰¹å¾â€äº§ç”Ÿçš„ä¿¡æ¯é€šé“å°±æ˜¯ä¾§ä¿¡é“ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä½ æ­£åœ¨ç ´è§£ä¸€ä¸ªä¿é™©ç®±çš„å¯†ç ï¼Œä»æ­£å¸¸çš„é€šä¿¡æ¸ é“æ¥è¯´ä½ åªèƒ½æš´åŠ›ç ´è§£ï¼Œé€ä¸ªå°è¯•ï¼Œä½†æ˜¯å½“ä½ ç ´è§£ç¬¬ä¸€ä½å¯†ç æ—¶ï¼Œä½ å‘ç°æ—‹é’®åˆ°äº†4ä¼šæœ‰ä¸€äº›å¾®å¼±çš„ä¸ä¸€æ ·çš„å“å£°ï¼Œé‚£ä¹ˆå¯ä»¥æœ‰ç†ç”±çŒœæµ‹ç¬¬ä¸€ä½å¯†ç æ˜¯4ï¼Œè¿™ä¸ªä¾‹å­é‡Œâ€œæ—‹é’®æ˜¯å¦å‘å‡ºå¼‚å“â€å°±æ˜¯ä¸€ä¸ªä¾§ä¿¡é“ï¼Œé€šè¿‡å®ƒæ”»å‡»è€…å¾—åˆ°äº†ä¿é™©ç®±çš„å¯†ç ã€‚Meltdownçš„æ”»å‡»åŸç†CPUè¿è¡Œçš„æ—¶å€™ï¼Œä¸å¯é¿å…çš„ï¼Œæ€»æ˜¯è¦ä»å†…å­˜ä¸­å–æ•°æ®çš„ï¼Œè€Œå†…å­˜ç›¸å¯¹ä¸CPUå¾ˆæ…¢ï¼Œä¸ºäº†é¿å…å–æ•°æ®æ—¶CPUç©ºç­‰ï¼ŒCPUå·¥ç¨‹å¸ˆå°±å‘æ˜äº†æŒ‡ä»¤é¢„å–æŠ€æœ¯ã€‚å‡è®¾æœ‰ä¸€ä¸ªç¨‹åºé•¿ä¸‹é¢è¿™æ ·ï¼šif (MEM == 0):\tinstructionA;MEM == 0ä¸ä¸€å®šæˆç«‹ï¼Œè‹¥MEM == 0ä¸æˆç«‹ï¼Œç«™åœ¨è½¯ä»¶çš„å±‚é¢æ¥æƒ³ï¼ŒinstructionAä¸åº”è¯¥è¢«æ‰§è¡Œï¼Œä½†æ˜¯ç”±äºæŒ‡ä»¤æŒ‡ä»¤é¢„å–æŠ€æœ¯çš„å­˜åœ¨ï¼ŒCPUä¼šâ€œæŠ¢è·‘â€ï¼Œæå‰å°†instructionAæ‰§è¡Œäº†ï¼Œå¦‚æœMEM == 0æˆç«‹ï¼Œé‚£å°±å¯ä»¥ç›´æ¥ç»§ç»­æ‰§è¡ŒinstructionAä¹‹åçš„æŒ‡ä»¤ï¼›ä¸æˆç«‹çš„è¯CPUéœ€è¦å›æ»šæŠŠinstructionAé€ æˆçš„å½±å“æ’¤é”€ã€‚å¦å¤–ï¼Œç”±äºcacheçš„å­˜åœ¨ï¼Œä»¥åŠç¼“å­˜å±€éƒ¨æ€§çš„é—®é¢˜ï¼Œåœ¨åŒä¸€æ—¶åˆ»ä¸åŒå†…å­˜åœ°å€çš„è®¿é—®é€Ÿåº¦å¹¶ä¸å‡åŒ€ï¼Œä¹Ÿå°±æ˜¯latencyå¹¶ä¸ç›¸åŒã€‚meltdownå°±æ˜¯åˆ©ç”¨äº†latencyè¿™ä¸€ä¿¡æ¯æ¥è·å–æ•æ„Ÿä¿¡æ¯çš„ï¼Œéå¸¸å¾—å…·æœ‰æƒ³è±¡åŠ›ã€‚ä¾‹å¦‚æˆ‘æƒ³æ”»å‡»æŸä¸€ä¸ªå¯¹è±¡ï¼Œè¦å¾—åˆ°å…¶ä¸­æŸä¸ªåœ°å€pträ¸­çš„å†…å®¹ï¼Œæˆ‘åªéœ€è¦è®¾æ³•å’Œæ”»å‡»å¯¹è±¡å…±äº«ä¸€ä¸ªæ•°ç»„Aï¼Œç„¶åè¯±å¯¼æ”»å‡»å¯¹è±¡åˆ©ç”¨ptrçš„å†…å®¹dataä½œä¸ºä¸‹æ ‡è®¿é—®è¿™ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆç”±äºä¹‹å‰è®¿é—®è¿‡A[data]äº†ï¼Œå†æ¬¡è®¿é—®åˆ°A[data]çš„æ—¶å€™latencyä¼šæ›´ä½ã€‚æ ¹æ®ä¸Šé¢çš„åŸç†ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ ä»¥ä¸‹çš„æ”»å‡»å†…æ ¸çš„meltdownç¨‹åºï¼šraise_exception();access A[*ptr]; // ptrå°±æ˜¯æˆ‘å¯¹æ”»å‡»å¯¹è±¡æ„Ÿå…´è¶£çš„åœ°å€, Aåˆ™æ˜¯æˆ‘è¿™ä¸ªè¿›ç¨‹é‡Œçš„ä¸€ä¸ªå†…å®¹æŒ‰ç†æ¥è¯´ï¼Œptrå¯¹äºæ”»å‡»ç¨‹åºçš„è¿›ç¨‹æ¥è¯´å¯èƒ½æ˜¯ä¸€ä¸ªéæ³•çš„åœ°å€ï¼Œæ“ä½œç³»ç»Ÿä¼šé˜»æ­¢å®ƒè®¿é—®ï¼Œå¹¶ä¸”å‰é¢æœ‰raise_exceptionè¿™ä¸ªå‡½æ•°ä¼šå¼•å‘ä¸€ä¸ªå¼‚å¸¸ï¼ŒæŒ‰ç†æ¥è¯´æ›´ä¸åº”è¯¥æ‰§è¡Œåˆ°ä¸‹é¢è¿™ä¸ªè¯­å¥ã€‚ä½†æ˜¯ï¼Œç”±äºé¢„å–çš„å­˜åœ¨ï¼ŒCPUæå‰è¯»äº†ptré‡Œçš„å†…å®¹ï¼Œé‚£ä¹ˆæˆ‘å†æ¬¡é€ä¸ªè®¿é—®Aé‡Œçš„å…ƒç´ ï¼Œå‘ç°æœ‰æŸä¸€ä¸ªå…ƒç´ çš„è®¿é—®å»¶è¿Ÿç‰¹åˆ«ä½ï¼Œäºæ˜¯ä¹æˆ‘ä»¬å°±çŸ¥é“ptré‡Œçš„å†…å®¹æ˜¯å¤šå°‘äº†ã€‚æƒ³è¦çŸ¥é“æŸä¸ªåœ°å€å¯¹åº”çš„å­—èŠ‚æ˜¯ä»€ä¹ˆï¼ŒAåªéœ€æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º256çš„æ•°ç»„å³å¯ã€‚å¤šä¹ˆå¯æ€•åˆæœ‰æƒ³è±¡åŠ›çš„æ”»å‡»æ‰‹æ®µã€‚è¦åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œéœ€è¦CPUåœ¨é¢„æµ‹å¤±è´¥çš„æ—¶å€™ä¸ä»…å°†å¯„å­˜å™¨å›æ»šï¼Œè¿˜éœ€è¦å°†Cacheä¹Ÿå›æ»šReference 15åˆ†é’Ÿè¯»æ‡‚è‹±ç‰¹å°”ç†”æ–­å¹½çµæ¼æ´ ç»™ç¨‹åºå‘˜è§£é‡ŠSpectreå’ŒMeltdownæ¼æ´" }, { "title": "GreptimeDB Heartbeatæœºåˆ¶è¯¦è§£", "url": "/posts/greptime-heartbeat/", "categories": "GreptimeDB", "tags": "WIP ğŸš§, GreptimeDB, Heartbeat", "date": "2023-12-28 16:14:00 +0800", "snippet": "æœ¬æ–‡å°†è®²è§£greptimedbå†…éƒ¨çš„heartbeatæœºåˆ¶ã€‚é¦–å…ˆçœ‹çœ‹å®˜ç½‘Developer guideçš„ä»‹ç»ï¼š Heartbeat Task is used to send heartbeat to the Metasrv. The heartbeat plays a crucial role in the distributed architecture of GreptimeDB an...", "content": "æœ¬æ–‡å°†è®²è§£greptimedbå†…éƒ¨çš„heartbeatæœºåˆ¶ã€‚é¦–å…ˆçœ‹çœ‹å®˜ç½‘Developer guideçš„ä»‹ç»ï¼š Heartbeat Task is used to send heartbeat to the Metasrv. The heartbeat plays a crucial role in the distributed architecture of GreptimeDB and serves as a basic communication channel for distributed coordination. The upstream heartbeat messages contain important information such as the workload of a Region. If the Metasrv has made scheduling(such as Region migration) decisions, it will send instructions to the Datanode via downstream heartbeat messages.Overviewå¯ä»¥çœ‹åˆ°åœ¨greptimedbä¸­Heartbeatåˆ†ä¸¤ä¸ªæ–¹å‘upstreamå’Œdownstreamï¼Œå¹¶ä¸”Datanodeå’ŒFrontendéƒ½ä¼šå‘Meta Serverå‘é€å¿ƒè·³ã€‚upstreamæ˜¯datanodeä¸ŠæŠ¥regionä¿¡æ¯åˆ°meta srvï¼Œdownstreamæ–¹å‘æ˜¯meta srvä¸»åŠ¨å‘datanodeå‘èµ·è°ƒåº¦ã€‚Datanodeçš„Heartbeatä¸»è¦é€»è¾‘ä½äºï¼šdatanode/src/heartbeat.rsé‡Œã€‚æ ¸å¿ƒæ˜¯HeartbeatTaskã€‚åœ¨Datanodeå¯åŠ¨çš„æ—¶å€™ï¼ŒHeartbeatTaskéšä¹‹startï¼Œå¹¶ä¸”Datanodeä¼šä¼ å…¥å…¶region_event_receiverå’Œleases_notifierç»™HeartbeatTaskã€‚region_event_receiveræ¥æ”¶RegionServerEventï¼Œä¹Ÿå°±æ˜¯regionçš„Registeredå’ŒDeregisteredä¸¤ä¸ªäº‹ä»¶ï¼Œå› ä¸ºHeartbeatä¸ŠæŠ¥çš„æ˜¯RegionStatï¼Œæ•…Regionå‘ç”Ÿäº†Registeredå’ŒDeregisteredæ—¶ï¼Œè‡ªç„¶éœ€è¦åšå‡ºå¯¹åº”çš„é€»è¾‘è°ƒæ•´ã€‚HeartbeatTaskçš„åˆ›å»ºé€»è¾‘ä½äºHeartbeatTask::try_newä¸­ã€‚é¦–å…ˆæ˜¯åˆ›å»ºäº†ä¸€ä¸ªregion_alive_keeperã€‚è¿™ä¸ªä¸œè¥¿éå¸¸é‡è¦ï¼Œé¦–å…ˆçœ‹çœ‹æºç é‡Œçš„æ–‡æ¡£æ˜¯æ€ä¹ˆè¯´çš„ï¼š/// [RegionAliveKeeper] manages all [CountdownTaskHandle]s.////// [RegionAliveKeeper] starts a [CountdownTask] for each region. When the deadline is reached,/// the status of region be set to \"readonly\", ensures there is no side-effect in the entity system.////// The deadline is controlled by the meta server. Datanode will send its opened regions info to meta sever/// via heartbeat. If the meta server decides some region could be resided in this Datanode,/// it will renew the lease of region, a deadline of [CountdownTask] will be reset.æ ¸å¿ƒæ„æ€å°±æ˜¯è¯´ï¼šregion_alive_keeperä¸ºæ¯ä¸ªregionç»´æŠ¤äº†ä¸€ä¸ªå€’è®¡æ—¶ä»»åŠ¡ï¼Œä¸€æ—¦è¿™ä¸ªä»»åŠ¡è¢«æ‰§è¡Œï¼Œregionå°±å˜æˆreadonlyçŠ¶æ€ï¼ˆä¸çŸ¥é“å’Œmemtableçš„frozenæœ‰æ²¡æœ‰å…³ç³»ï¼‰ã€‚heartbeatæ—¶ä¼šä¸ŠæŠ¥æ‰€æœ‰opençš„regionçš„RegionStatï¼Œå¦‚æœmeta srvè®¤ä¸ºè¿™ä¸ªregionèƒ½ç»§ç»­å­˜æ´»ï¼Œå°±ä¼šåˆ·æ–°è¿™ä¸ªregionçš„leaseï¼Œä¹Ÿå°±æ˜¯é‡ç½®å€’è®¡æ—¶ã€‚RegionAliveKeeperæœ‰ä¸€ä¸ªepochï¼ŒæŒ‡çš„æ˜¯è¯¥RegionAliveKeeperåˆ›å»ºçš„æ—¶é—´ï¼Œåˆ·æ–°regionçš„leaseçš„æ—¶å€™ä¼šä»¥è¿™ä¸ªepochä¸ºåŸºå‡†è¿›è¡Œè®¡ç®—(RegionAliveKeeperä½œä¸ºHeartbeatResponseHandlerçš„è¡Œä¸º)ï¼›å‘é€HearbeatRequestçš„æ—¶å€™ä¹Ÿä»¥epochä½œä¸ºåŸºå‡†ï¼Œè®¡ç®—å½“å‰æ—¶é—´å’Œepochçš„åç§»é‡duration_since_epochå¹¶æ”¾åœ¨Requesté‡Œä¸ŠæŠ¥ã€‚ç„¶åæ˜¯åˆ›å»ºä¸€ä¸ªresp_handler_executorï¼Œè¿™é‡Œresp_handler_executorçš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªArc&lt;dyn HeartbeatResponseHandlerçš„vecï¼ŒåŒ…äº†ä¸€å±‚æŠ½è±¡å«HandlerGroupExecutorï¼Œæ¥æ”¶åˆ°respä»¥åå°±éå†æ‰§è¡Œè¿™ç»„HeartbeatResponseHandlerã€‚åˆ›å»ºHeartbeatTaské˜¶æ®µæ¯”è¾ƒtrivialçš„è§£æoptionsä¹‹ç±»çš„é€»è¾‘å°±ä¸å†èµ˜è¿°äº†ï¼Œä¸è¿‡å€¼å¾—æ³¨æ„çš„æ˜¯HeartbeatTaskè¿˜å–äº†åˆ›å»ºä»»åŠ¡çš„æ—¶é—´å¹¶è®°å½•åœ¨node_epochå­—æ®µé‡Œã€‚HeartbeatTaskçš„å¯åŠ¨åˆ›å»ºå®Œä»¥åå°±è¿›è¡ŒHeartbeatTaskçš„å¯åŠ¨äº†ã€‚å¯åŠ¨çš„æ ¸å¿ƒé€»è¾‘å¦‚ä¸‹ï¼šé¦–å…ˆåˆ¤æ–­ä¸€ä¸‹å½“å‰taskæ˜¯å¦å·²ç»å¯åŠ¨è¿‡äº†ï¼Œé¿å…é‡å¤å¯åŠ¨ã€‚ç„¶åå–ä¸€å¤§å †interval,node_id,node_epoch,addr,meta_client ä¹‹ç±»çš„æ•°æ®,å¹¶åˆ›å»ºäº†ä¸€ä¸ªé€»è¾‘ä¸Šå¯ä»¥ç§°ä¸ºoutgoingçš„ç®¡é“ã€‚ç”¨outgoing_txåˆ›å»ºäº†ä¸€ä¸ªHeartbeatMailboxã€‚ç”¨å‰é¢è·å–çš„æ•°æ®åˆ›å»ºäº†ä¸€ä¸ªå’Œmeta_srvä¹‹é—´çš„heartbeat streamï¼Œå¹¶ä¸”è·å–ä¸€ä¸ªèƒ½é€šè¿‡è¯¥streamå‘é€Heartbeatçš„HeartbeatSenderç§°ä¹‹ä¸ºtx,è€Œåˆ›å»ºstreamæ—¶åšäº†ä»€ä¹ˆè¿™é‡ŒæŒ‰ä¸‹ä¸è¡¨ï¼Œåé¢å†è¯´ã€‚å–å¾—äº†txä»¥åï¼Œå¯åŠ¨äº†region_alive_keeper`ã€‚ç„¶ååˆ›å»ºäº†ä¸€ä¸ªæ­»å¾ªç¯ï¼Œå¾ªç¯çš„é€»è¾‘å¦‚ä¸‹ï¼š åˆ¤æ–­å½“å‰ä»»åŠ¡æ˜¯å¦è¢«å…³é—­äº†ï¼Œæ˜¯å°±é€€å‡º å¦åˆ™ï¼Œtokio::selectä¸‰ä»¶äº‹ï¼š è¦ä¹ˆä»outgoingè¿™ä¸ªchannelä¸­æ”¶åˆ°ä¸€ä¸ªmessageï¼ŒæŠŠè¿™ä¸ªMailboxMessageencodeæˆä¸€ä¸ªHeartbeatRequest äºæ˜¯æœ‰ä¸€ä¸ªè¿™æ ·çš„æ•°æ®æµmailbox-&gt;tx-&gt;meta srv mailboxçš„æ•°æ®æ¥æº å¯¹IncomingMessageï¼ˆä¹Ÿå°±æ˜¯Meta srvå¯¹Datanodeå‘å‡ºçš„Instructionï¼‰å¯¹åº”çš„å“åº”(OutgoingMessage=MessageMeta+InstructionReply) è¦ä¹ˆç¡å¤Ÿäº†intervalè¿™ä¹ˆé•¿çš„æ—¶é—´(ç¬¬ä¸€æ¬¡è¿›å¾ªç¯æ—¶ä¸ç¡ï¼Œç›´æ¥è¿›è¿™ä¸ªäº‹ä»¶)ï¼Œæ”¶é›†æ‰€æœ‰opened_regionçš„region_statï¼Œæ„é€ HeartbeatRequest è¦ä¹ˆæ”¶åˆ°äº†quit_signalï¼Œæ„é€ ä¸€ä¸ªdummy heartbeat requestï¼Œé€šè¿‡åç»­å‘é€é‡æ–°å»ºç«‹heartbeat streamã€‚ é€šè¿‡tx(HeartbeatSender)å‘é€ä¸Šä¸€æ­¥æ„é€ çš„HeartbeatRequst,å¦‚æœå‘é€å‡ºç°é”™è¯¯ï¼Œå°è¯•é‡æ–°å»ºç«‹heartbeat stream HeartbeatStream ä¸Šæ–‡æåˆ°äº†åœ¨å¯åŠ¨HeartbeatTaskçš„æ—¶å€™ä¼šé€šè¿‡create_streamsè¿™ä¸ªå‡½æ•°åˆ›å»ºä¸€ä¸ªheartbeat streamï¼Œé€šè¿‡heartbeat streamè¿›è¡Œmeta srvå’Œdatanodeä¹‹é—´å¿ƒè·³åŒ…çš„åŒå‘é€šè®¯ã€‚è¿™ä¸ªheartbeat streamçš„txç«¯å¦‚ä½•ä½¿ç”¨ä¸Šæ–‡å·²ç»è¯´è¿‡äº†ï¼Œè€Œcreate_streamsä¸­åˆ™åˆ›å»ºäº†datanodeå¤„ç†rxç«¯çš„æ­»å¾ªç¯ï¼Œå¾ªç¯å°±æ˜¯ä¸æ–­å¤„ç†æ¥è‡ªmeta srvçš„åŒ…ï¼Œæ•°æ®åŒ…å¯èƒ½æ˜¯mailbox incoming messageï¼Œä¹Ÿå¯èƒ½æ˜¯æ™®é€šçš„region_leaseåˆ·æ–°messageï¼Œå¤„ç†æ—¶ä¼šå¯¹è¿™äº›æ•°æ®åŒ…åšäº›ä¿¡æ¯æ”¶é›†å·¥ä½œ(æ‰“info logæˆ–è€…æ”¶é›†åˆ°metricé‡Œ)ï¼Œç„¶åå°±æ˜¯è®©å‰æ–‡çš„handler_executorå¤„ç†è¿™äº›åŒ…ï¼Œæœ€åå¦‚æœä¸Šæ–‡çš„lease_notifierå­˜åœ¨ï¼Œé‚£å°±notifyä¸€ä¸‹ã€‚ä¸Šé¢éƒ½æ˜¯æ­£ç¡®è¿è¡Œæ—¶çš„å¾ªç¯é€»è¾‘ï¼Œå¦‚æœä»rxç«¯æ¥æ”¶æ•°æ®åŒ…çš„æ—¶å€™å‘ç”Ÿé”™è¯¯äº†ï¼Œé‚£å¾ªç¯å°±é€€å‡ºäº†ï¼Œå¹¶ä¸”å‘quit_signalä¸­å‘é€ä¿¡å·ï¼Œè¡¨æ˜å½“å‰æµè¢«æ–­å¼€ã€‚ä¸Šé¢æ˜¯rxç«¯å¤„ç†çš„é€»è¾‘ã€‚é€šè¿‡å‰é¢çš„ç»¼åˆåˆ†æï¼Œå¯ä»¥å¾—åˆ°ä¸‹é¢çš„å›¾ï¼Œdatanodeå’ŒMetaSrvå¯ä»¥åŒå‘é€šè®¯ï¼Œå¹¶éç®€å•çš„C/Sæ¨¡å¼ï¼š è€Œå»ºç«‹streamçš„é€»è¾‘å®é™…ä¸Šåœ¨meta_client.heartbeat()ä¸­ï¼Œmeta_client.heartbeat()è½¬åˆ°äº†heartbeat_client().heartbeat()é‡Œï¼Œè¿™é‡Œå¯ä»¥å‚è€ƒ[[MetaClient]]ã€‚heartbeat_client().hearbeat()ç¬¬ä¸€æ­¥æ˜¯ask_leaderï¼Œå…¶æµç¨‹æ˜¯è·å–å½“å‰çš„leadership_groupçš„æ‰€æœ‰peersåshuffleä¹‹ï¼Œå†éå†ä¸€è¶Ÿï¼Œå‘æ¯ä¸ªpeerå‘é€AskLeaderRequestï¼Œå¾—åˆ°leaderä»¥åï¼Œå‘leadership_groupå†™å…¥leaderä¿¡æ¯ã€‚ç¬¬äºŒæ­¥æ˜¯çœŸæ­£çš„inner.heartbeat()ï¼Œé€»è¾‘å¦‚ä¸‹ï¼š æ„é€ ä¸€ä¸ªè¿æ¥åˆ°leaderçš„client æ„é€ ç”¨äºå‘é€è¯·æ±‚çš„mpsc::channel::&lt;HeartbeatRequest&gt;(128)(è¿™åº”è¯¥æ˜¯tonicè¿™ä¸ªæ¡†æ¶é‡Œçš„æŸç§idiom) let (sender, receiver) = mpsc::channel::&lt;HeartbeatRequest&gt;(128);sender.send(handshake).await.map_err(|e| {...});let receiver = ReceiverStream::new(receiver);let mut stream = leader .heartbeat(receiver) .await// åç»­å‘é€è¯·æ±‚åªè¦å¾€senderé‡Œsendå°±è¡Œäº†ï¼Œä¸ç”¨å…³å¿ƒåˆ«çš„ æ„é€ åŒ…å«å½“å‰èŠ‚ç‚¹node_idå’Œroleç«¯çš„RequestHeader æ„é€ ä¸€ä¸ªèµ·æ¡æ‰‹ä½œç”¨çš„HeartbeatRequestï¼Œå¹¶ç”¨senderå‘é€ä¹‹ æ„é€ å’Œleaderä¹‹é—´çš„stream è·å–ä¸Šé¢çš„è¯·æ±‚å“åº”ï¼Œé”™è¯¯äº†å°±å¤„ç†é”™è¯¯ åŒ…è£…ä¸Šé¢ç®¡é“çš„senderä¸ºè¯·æ±‚senderï¼ŒåŒ…è£…streamä¸ºreceiverMeta Serverå¯¹HeartbeatRequestçš„å¤„ç†çºµè§ˆé€»è¾‘é¦–å…ˆæ‰¾åˆ°æœ€å…³é”®çš„trait,HeartbeatHandlerã€‚#[async_trait::async_trait]pub trait HeartbeatHandler: Send + Sync { fn is_acceptable(&amp;self, role: Role) -&gt; bool; fn name(&amp;self) -&gt; &amp;'static str { let type_name = std::any::type_name::&lt;Self&gt;(); // short name type_name.split(\"::\").last().unwrap_or(type_name) } async fn handle( &amp;self, req: &amp;HeartbeatRequest, ctx: &amp;mut Context, acc: &amp;mut HeartbeatAccumulator, ) -&gt; Result&lt;HandleControl&gt;;}çœ‹åˆ°è¿™é‡Œå°±èƒ½çŒœåˆ°å¤§æ¦‚çš„ç»“æ„å°±æ˜¯æœ‰ä¸€ä¸ªæ€»çš„handlerï¼Œç„¶åæ ¹æ®ä¸åŒHeartbeatçš„ç±»å‹å°†å…¶åˆ†å‘ç»™å…·ä½“çš„handlerï¼ˆç­–ç•¥æ¨¡å¼ï¼‰ ã€‚æ€»çš„handleråœ¨impl heartbeat_server::Heartbeat for MetaSrvé‡Œï¼Œheartbeat_server::Heartbetaè¿™ä¸ªtraitå®šä¹‰æ ¸å¿ƒé€»è¾‘éå¸¸ç®€å•ï¼špub trait Heartbeat {\ttype HeartbeatStream;\tfn heartbeat(&amp;self, tonic::Request&lt;tonic::Streaming&lt;...&gt;&gt;)-&gt;...;\tfn ask_leader(&amp;self, request: tonic::Request&lt;AskLeaderRequest&gt;)-&gt;...;}MetaSrvçš„heartbeatä¹Ÿéå¸¸ç®€å•ï¼Œæ ¸å¿ƒæ˜¯ä¸€ä¸ªå¾ªç¯ï¼Œä¸æ–­å¾—ä»streamé‡Œå–å‡ºrequestï¼Œè¿›è¡Œä»¥ä¸‹æ“ä½œï¼š è§£ærequestï¼Œé¦–å…ˆmatchçœ‹çœ‹æ˜¯ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„requestï¼Œä¸ç„¶è¿›é”™è¯¯å¤„ç†(Erråˆ†æ”¯) å–å‡ºheaderï¼Œæ²¡æœ‰headerå°±æŠ¥é”™ å¦‚æœpusher_keyæ˜¯None å–å‡ºnode_idï¼Œæ³¨æ„ï¼Œdatanodeå’Œfrontendçš„heartbeatéƒ½æ˜¯èµ°è¿™ä¸ªå¤„ç†å‡½æ•°çš„ï¼Œdatanodeçš„node_idæ˜¯ç”±datanodeä¼ é€’è¿‡æ¥çš„member_idï¼Œè™½ç„¶datanodeä¼ è¿‡æ¥çš„id=(cluster_id, member_id)ï¼Œä½†è¿™é‡Œåªç”¨äº†member_idã€‚è€Œfrontendåˆ™æ˜¯ä¸€ä¸ªmetasrvå†…éƒ¨çš„è‡ªå¢AtomicU64 å–å‡ºroleï¼Œä¹Ÿå°±æ˜¯è¯·æ±‚å‘é€æ–¹åˆ°åº•æ˜¯datanodeè¿˜æ˜¯frontend node_idå’Œroleæ‹¼æˆkeyï¼Œç„¶åå‘handle_groupé‡Œç”¨è¿™ä¸ªkeyæ³¨å†Œä¸€ä¸ªè¿”å›è¯·æ±‚çš„pusherï¼Œhandle_groupé‡Œæœ‰ä¸€ä¸ªä»keyåˆ°pusherçš„mapï¼Œpusherç”¨äºä¸»åŠ¨å‘ä¸‹æ¸¸å‘é€ä¿¡æ¯(MailboxMessage)ï¼Œæ‰€ä»¥å¯ä»¥çŒœæµ‹ï¼Œå‘é€MailboxMessageçš„æ—¶å€™ï¼Œæ”¶ä¿¡æ–¹æ˜¯ä»¥keyæ¥æ ‡è¯†çš„ï¼Œä¹Ÿå°±æ˜¯HeartbeatMailbox::sendé‡Œçš„pusher_idã€‚ å°†pusher_keyè®¾ä¸ºSome(key)ï¼Œè¿™é‡Œpusher_keyä¸ä¸ºNoneä»¥åå°±ä¸ç”¨å†è¿›è¿™ä¸ªåˆ†æ”¯ï¼Œå› ä¸ºheartbeatæ—¶Clientå’ŒServerä¹‹é—´æ˜¯é•¿è¿æ¥çš„Streamï¼Œåé¢Clientçš„keyä¹Ÿä¸ä¼šå˜åŒ–ï¼Œç¬¬ä¸€æ¬¡handshakeå®Œäº†ä»¥åï¼Œå°±ä¸éœ€è¦é‡æ–°æ„å»ºé“¾æ¥ï¼Œä¹Ÿå°±ä¸éœ€è¦å†æ³¨å†ŒkeyåŠå…¶å¯¹åº”çš„Pusherã€‚(Frontendå› ä¸ºæ˜¯æ— çŠ¶æ€çš„ï¼ŒçŒœæµ‹å…¶node_idä¼šç”±ç¬¬ä¸€æ¬¡handshakeä»MetaSrvå¤„åˆ†é…ååœ¨Responseé‡Œè·å¾—)ã€‚ äºæ˜¯æ•´ä½“æ•°æ®çš„æµåŠ¨å¯ä»¥çœ‹æˆè¿™æ · ä½¿ç”¨HandlerGroupå»handleè¿™ä¸ªrequestï¼Œå¹¶å¾—åˆ°result é€»è¾‘ä¸ŠHandlerGroupæ˜¯ä¸€ä¸ªHeartbeatHandlerçš„Vecï¼Œä¸è¿‡æœ‰ç‚¹å°ç»†èŠ‚çš„æ˜¯ï¼Œå®é™…ç”¨çš„æ˜¯NameCachedHandlerè¿™ä¸ªåŒ…è£…ï¼Œå…¶ä½œç”¨æ˜¯ç¼“å­˜äº†HeartbeatHandler.name()çš„ç»“æœï¼Œé¿å…æ¯æ¬¡éƒ½å¯¹è¿™ä¸ªå¸¸é‡å»æ±‚å€¼(è¿™é‡Œnameç­‰äºå®é™…çš„struct type name) HandlerGroup::handleéå†æ‰€æœ‰handlerï¼Œä¸€è¾¹éå†ä¸€è¾¹æŠŠä¸­é—´ç»“æœå­˜åˆ°HeartbeatAccumulatorä¸­ï¼Œæ¯ä¸ªhandlerè¿”å›Continueæˆ–è€…Doneï¼Œè¿”å›Doneè¯´æ˜è¿™ä¸ªè¯·æ±‚å·²ç»å¤„ç†å®Œäº†ï¼Œç›´æ¥è·³å‡ºå¾ªç¯ï¼Œç„¶åæŠŠaccmulatorçš„å†…å®¹æå–å¹¶è¿”å› HandlerGroupé‡Œè¿˜æœ‰pushers æ ¹æ®resultåˆ¤æ–­å½“å‰streamè¿æ¥çš„è¿˜æ˜¯ä¸æ˜¯leader,å¦‚æœå·²ç»ä¸æ˜¯leaderäº†ï¼Œä¸»åŠ¨æ–­å¼€å½“å‰çš„stream æ–­å¼€streamçš„æ—¶å€™å°†ç¬¬3æ­¥æ³¨å†Œçš„pusherç»™unregisteræ‰ æ¯ä¸ªhandlerçš„é€»è¾‘CollectStatsHandler èŒè´£ï¼šè´Ÿè´£æ”¶é›†HeartbeatRequestä¸­çš„statåˆ°accumulator.statä¸­ã€‚ æ¥å—è¯·æ±‚æ¥æºï¼šåªæ¥å—æ¥è‡ªdatanodeçš„Heartbeatï¼Œå¹¶ä¸”ä¸å¤„ç†MailboxMessageï¼ˆMailboxMessageä¸ä¼šæœ‰statï¼‰ã€‚ å®ç°é€»è¾‘ï¼š å¦‚æœè¯·æ±‚æ˜¯MailboxMessageï¼Œç›´æ¥è¿”å›Continueã€‚ å°è¯•ä»Requestä¸­æå–å‡ºStatï¼ŒæˆåŠŸæå–äº†å°±å°†statæ’å…¥accumulator.statï¼Œå¤±è´¥äº†æ‰“ä¸€æ¡è­¦å‘Šä¿¡æ¯ è¿”å›Continue CheckLeaderHandler èŒè´£ï¼šåˆ¤æ–­å½“å‰MetaSrvæ˜¯å¦ä»æ˜¯Leader æ¥å—è¯·æ±‚æ¥æºï¼šåªæ¥å—æ¥è‡ªdatanodeçš„Heartbeatã€‚ å®ç°é€»è¾‘ï¼š å¦‚æœå½“å‰contexté‡Œæ²¡æœ‰electionæ¨¡å—(æ²¡æœ‰å¯èƒ½æ˜¯å•èŠ‚ç‚¹æ¨¡å¼)ï¼Œç›´æ¥è¿”å›Continue ç”¨ä¸Šé¢è·å–åˆ°çš„electionæ¨¡å—åˆ¤æ–­å½“å‰metasrvæ˜¯å¦æ˜¯leaderï¼Œæ˜¯leaderå¯ä»¥ç›´æ¥è¿”å›Continue ä¸æ˜¯leaderå°±åœ¨Responseçš„headeré‡Œå†™å…¥é”™è¯¯ä¿¡æ¯Error::is_not_leader() è¿”å›Doneï¼Œå› ä¸ºå½“å‰èŠ‚ç‚¹ä¸æ˜¯leaderçš„è¯ï¼Œåé¢çš„handlerä¹Ÿæ²¡æœ‰å¿…è¦å†ç»§ç»­åšäº† KeepLeaseHandler èŒè´£ï¼šç»´æŠ¤æ¯ä¸ªèŠ‚ç‚¹ä¸Šæ¬¡ç»­ç§Ÿçš„æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯nodeåˆ°leaseçš„KVå¯¹ æ¥å—è¯·æ±‚æ¥æºï¼šdatanode å®ç°é€»è¾‘ï¼š å–å‡ºRequestçš„headerå’Œpeer(è¯·æ±‚æ¥è‡ªè°)ï¼Œæ²¡æœ‰ç›´æ¥è¿”å› æ‹¼å‡ºlease_key:(cluster_id,node_id) æ‹¼å‡ºlease_valueï¼šå½“å‰çš„æ—¶é—´æˆ³ï¼ˆè¯­ä¹‰ä¸ºä¸Šæ¬¡æ´»åŠ¨æ—¶é—´ï¼‰å’Œpeerçš„åœ°å€ æŠŠä¸Šé¢çš„keyå’Œvalueè½¬æˆå­—èŠ‚æ•°ç»„(Vec&lt;u8&gt;)ï¼Œå†™å…¥å­˜å‚¨å…ƒæ•°æ®çš„KVåº“ã€‚è¿™é‡Œå†™å…¥çš„æ˜¯ResettableKvBackendï¼Œæ²¡æœ‰è¿›è¡ŒæŒä¹…åŒ– è¿”å›Continue RegionLeaseHandler æ ¸å¿ƒé€»è¾‘ å–å‡ºstatçš„æ‰€æœ‰regionsåŠå…¶æ‰€åœ¨çš„cluster_idå’Œdatanode_id åˆ·æ–°æ¯ä¸ªcluster_id,datanode_idå’Œregion_idæ„æˆçš„ä¸‰å…ƒç»„å¯¹åº”çš„leaseï¼›è¿”å›ä¸å­˜åœ¨çš„regionä»¥åŠæˆåŠŸåˆ·æ–°çš„regionæœ‰å“ªäº›(æ³¨æ„region_idå’Œroleæ‰æ„æˆä¸€ä¸ªå®Œæ•´çš„regionæè¿°ç¬¦) æˆåŠŸåˆ·æ–°leaseçš„regionsé›†åˆè½¬æˆGrantedRegionçš„vector PersistStatsHandler æ¥å—è¯·æ±‚æ¥æºï¼šdatanode å…·ä½“å®ç°é€»è¾‘ï¼š å–å‡ºaccumulatoré‡Œçš„statï¼Œæ²¡æœ‰å°±ç›´æ¥è¿”å› å–statçš„stat_key(åŒæ ·æ˜¯(cluster_id, node_id)) PersistStatsHandlerå†…æœ‰ä¸€ä¸ªStatKey-&gt;EpochStatsçš„DashMapï¼Œç§°ä¸ºstats_cache EpochStats=Optional Epoch + Vector of Stat å–å‡ºstat_cacheé‡Œè®°å½•çš„epoch_statï¼Œæ²¡æœ‰å°±æ’ä¸ªé»˜è®¤çš„ åˆ¤æ–­æ˜¯å¦éœ€è¦åˆ·æ–°epoch å¦‚æœepoch_staté‡Œå­˜åœ¨epoch,å¦‚æœcurrent_statä¼ è¿‡æ¥çš„node_epochæ›´å¤§å°±æ›´æ–°ï¼Œå¹¶ä¸”æ¸…ç©ºä¹‹å‰è®°å½•çš„æ‰€æœ‰stat(å› ä¸ºè¿™æ„å‘³ç€nodeå¯èƒ½é‡æ–°deployäº†ï¼Œnode_epochå‘ç”Ÿäº†æ”¹å˜);node_epochæ›´å°å°±æ˜¯æ¥æ”¶åˆ°äº†è¿‡æœŸçš„heartbeatï¼Œé‚£ä¹ˆå¿½ç•¥ï¼Œå¹¶è­¦å‘Šï¼›å¦‚æœnode_epochå’Œepochç›¸ç­‰ï¼Œåˆ™æ˜¯æ­£å¸¸çš„ å¦‚æœepoch_staté‡Œä¸å­˜åœ¨epochï¼Œæ¯«æ— ç–‘é—®ï¼Œç›´æ¥è®¾ç½®current_staté‡Œä¼ è¿‡æ¥çš„node_epochä½œä¸ºepoch å‘epoch_statä¸­æ’å…¥current_stat å¦‚æœä¹‹å‰åˆ¤æ–­ä¸éœ€è¦åˆ·æ–°epochï¼Œé‚£ä¹ˆåªéœ€è¦åˆ¤æ–­epoch_statsé‡Œè®°å½•çš„statæ•°é‡æ˜¯å¦å°äºé˜ˆå€¼MAX_CACHED_STATS_PER_KEYï¼Œå°äºå°±è¿”å›Continue å¦åˆ™ï¼Œéœ€è¦æŒä¹…åŒ–epoch_statsäº†ï¼ŒæŠŠepoch_statsçš„æ‰€æœ‰statsæ‹å‡ºæ¥(drain_all)ç„¶åå†™åˆ°in_memoryçš„KVé‡Œ ç»“è®ºï¼š statsåšäº†ä¸€ä¸ªå¤šé˜¶æ®µçš„Cacheï¼Œé¦–å…ˆåœ¨Hadleré‡ŒæŒ‰(cluster_id,node_id)ä½œä¸ºkeyï¼Œç»´æŠ¤äº†ä¸€ä¸ªè®°å½•å¯¹åº”çš„statsçš„å±€éƒ¨cacheï¼Œç”¨epochæ¥åˆ¤æ–­å½“å‰çš„statsæ˜¯å¦ä»ç„¶åˆæ³•ï¼›å†™æ»¡äº†å°±å†™åˆ°å…¨å±€çš„in_memoryé”®å€¼å­˜å‚¨é‡Œï¼Œç¼“è§£å…¨å±€in_memoryå­˜å‚¨çš„å‹åŠ› Datanodeå¯¹HeartbeatResponseçš„å¤„ç†" }, { "title": "æ•°æ®åº“é¢†åŸŸä¼šè®®å’ŒæœŸåˆŠåˆé›†", "url": "/posts/database-conference/", "categories": "Database Research", "tags": "", "date": "2023-12-28 15:22:00 +0800", "snippet": "ä»¥ä¸‹æ˜¯ä¸€äº›æ•°æ®åº“ç›¸å…³é¢†åŸŸçš„ä¼šè®®ä»¥åŠæœŸåˆŠä¼šè®®Aç±»ä¼šè®® VLDB - Very Large Data Bases CIDR - Conference on Innovative Data Systems Research SIGMOD - Special Interest Group on Management of Data ICDE - The International Counc...", "content": "ä»¥ä¸‹æ˜¯ä¸€äº›æ•°æ®åº“ç›¸å…³é¢†åŸŸçš„ä¼šè®®ä»¥åŠæœŸåˆŠä¼šè®®Aç±»ä¼šè®® VLDB - Very Large Data Bases CIDR - Conference on Innovative Data Systems Research SIGMOD - Special Interest Group on Management of Data ICDE - The International Council for Open and Distance Education OSDI - Operating Systems Design and Implementation FAST - File and Storage TechnologiesBç±»ä¼šè®® EDBT - Extending Database Technology ICDT - The International Conference on Database Theory DASFAA - Database Systems for Advanced ApplicationsæœŸåˆŠAç±»æœŸåˆŠ VLDBJ - VLDBåŸºé‡‘ä¼šä¸»ç®¡çš„æœŸåˆŠ TKDE - IEEE Transactions on Knowledge and Data EngineeringBç±»æœŸåˆŠ TKDD - Transactions on Knowledge Discovery from Data" }, { "title": "æ³›å‹åœ¨Goä¸­çš„åº”ç”¨", "url": "/posts/go-generics/", "categories": "Go", "tags": "Generics, Error Handling", "date": "2022-03-22 20:08:00 +0800", "snippet": "Go1.18æ­£å¼å‘å¸ƒï¼Œä»æ­¤Goç®—æ˜¯æ­£å¼æœ‰äº†æ³›å‹ï¼Œæœ¬æ–‡æ¥æ¢è®¨Goæ³›å‹çš„å‡ ç§åº”ç”¨åœºæ™¯ã€‚ç±»å‹å®‰å…¨çš„å‡½æ•°å¼æ¥å£åœ¨Goè¯­è¨€é‡Œï¼Œå‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥è¿›è¡Œä¸€å®šç¨‹åº¦çš„å‡½æ•°å¼ç¼–ç¨‹ï¼Œä½†æ˜¯å› ä¸ºGoæ‹‰èƒ¯çš„ç±»å‹ç³»ç»Ÿä»¥åŠLambdaè¡¨è¾¾å¼çš„ç¼ºä½ï¼ŒGoåšèµ·å‡½æ•°å¼ç¼–ç¨‹æ¥æ€»æ˜¯ä¸å¤ªèˆ’æœï¼Œç°åœ¨æœ‰äº†å‚æ•°åŒ–ç±»å‹ä»¥åmapï¼Œfoldï¼Œfilterç­‰å‡½æ•°æ€»ç®—æ˜¯èƒ½èˆ’æœäº›äº†ã€‚æ¥ä¸‹æ¥çœ‹çœ‹å¦‚ä½•åˆ©ç”¨æ³›å‹å®ç°å‡ºç±»å‹å®‰å…¨çš„Mapï¼Œ Filt...", "content": "Go1.18æ­£å¼å‘å¸ƒï¼Œä»æ­¤Goç®—æ˜¯æ­£å¼æœ‰äº†æ³›å‹ï¼Œæœ¬æ–‡æ¥æ¢è®¨Goæ³›å‹çš„å‡ ç§åº”ç”¨åœºæ™¯ã€‚ç±»å‹å®‰å…¨çš„å‡½æ•°å¼æ¥å£åœ¨Goè¯­è¨€é‡Œï¼Œå‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥è¿›è¡Œä¸€å®šç¨‹åº¦çš„å‡½æ•°å¼ç¼–ç¨‹ï¼Œä½†æ˜¯å› ä¸ºGoæ‹‰èƒ¯çš„ç±»å‹ç³»ç»Ÿä»¥åŠLambdaè¡¨è¾¾å¼çš„ç¼ºä½ï¼ŒGoåšèµ·å‡½æ•°å¼ç¼–ç¨‹æ¥æ€»æ˜¯ä¸å¤ªèˆ’æœï¼Œç°åœ¨æœ‰äº†å‚æ•°åŒ–ç±»å‹ä»¥åmapï¼Œfoldï¼Œfilterç­‰å‡½æ•°æ€»ç®—æ˜¯èƒ½èˆ’æœäº›äº†ã€‚æ¥ä¸‹æ¥çœ‹çœ‹å¦‚ä½•åˆ©ç”¨æ³›å‹å®ç°å‡ºç±»å‹å®‰å…¨çš„Mapï¼Œ Filterï¼Œ Foldlï¼ŒFoldrã€‚å®ç°ä»è¿™å‡ ä¸ªå‡½æ•°çš„ç±»å‹ç­¾åå…¥æ‰‹ï¼Œç„¶åæŒ‰è¯­ä¹‰è¿›è¡Œç¿»è¯‘å°±æ˜¯äº†ï¼š è¿™é‡Œç±»å‹ç­¾åé‡‡ç”¨æˆ‘åçˆ±çš„Haskellçš„ç±»å‹ç­¾åï¼ˆåŒæ—¶æ··åˆä½¿ç”¨äº†Goçš„ç±»å‹ï¼‰ï¼Œä¸ªäººè®¤ä¸ºè¿™ç§è®°æ³•çš„å¥½å¤„åœ¨äºåˆ†ç¦»äº†identifierå’Œtype signatureï¼Œä¾¿äºä¸€çœ¼çœ‹å‡ºå‡½æ•°çš„ç±»å‹ä»¥åŠè¿›è¡Œç±»å‹çš„è¿ç®—ï¼›è¿™ç§è®°æ³•é‡Œçš„-&gt;å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ˜ å°„ Map :: (A -&gt; B) -&gt; []A -&gt; []B å¯¹åº”çš„Goå®ç°: func Map[A, B any](f func(A) B, l []A) []B { res := make([]B, len(l)) for i, e := range l { res[i] = f(e) } return res} Filter :: (A -&gt; bool) -&gt; []A -&gt; []A å¯¹åº”çš„Goå®ç°: func Filter[A any](f func(A) bool, l []A) []A { res := make([]A, 0, len(l)) for _, e := range l { if f(e) { res = append(res, e) } } return res} Foldl :: (B -&gt; A -&gt; B) -&gt; B -&gt; []A -&gt; B å¯¹åº”çš„Goå®ç° func Foldl[A, B any](f func(B, A) B, b B, l []A) B { res := b for _, e := range l { res = f(res, e) } return res} Foldr :: (A -&gt; B -&gt; B) -&gt; B -&gt; []A -&gt; B å¯¹åº”çš„Goå®ç° func Foldr[A, B any](f func(A, B) B, b B, l []A) B {\tres := b\tfor i := len(l) - 1; i &gt;= 0; i-- {\t\tres = f(l[i], res)\t}\treturn res} ForEach :: (A -&gt; Unit) -&gt; []A -&gt; Unit è¿™é‡ŒUnitç”¨æ¥è¡¨ç¤ºæ— è¿”å› å¯¹åº”çš„Goå®ç° func ForEach[A any](f func(A), l []A) {\tfor _, e := range l {\t\tf(e)\t}}å€ŸåŠ©ä¸Šé¢è¿™äº›åŸºæœ¬å‡½æ•°å¯ä»¥å®ç°å‡º:concatï¼ŒconcatMapfunc Concat[A any](l [][]A) []A {\treturn Foldl(func(a []A, b []A) []A { return append(a, b...) }, []A{}, l)}func ConcatMap[A, B any](f func(A) []B, l []A) []B { return Concat(Map(f, l))}åº”ç”¨æ¯”è¾ƒå¸¸è§çš„ç®€å•åº”ç”¨å°±ä¸è¯´äº†ï¼Œä¾‹å¦‚Webå¼€å‘ä¸­å¯ä»¥åˆ©ç”¨Mapæ–¹ä¾¿åœ°è¿›è¡ŒVo,Dto,Entityä¹‹é—´çš„è½¬æ¢ã€‚è¿™é‡Œç»™å‡ ä¸ªæ¯”è¾ƒfancyçš„ä¾‹å­ï¼š å…¨æ’åˆ—å‡½æ•°(è¿™é‡Œå‡è®¾åˆ—è¡¨é‡Œæ²¡æœ‰é‡å¤å…ƒç´ äº†ï¼Œä¸ºäº†Removeå®ç°æ–¹ä¾¿ä¸€ç‚¹)func Remove(x int, l []int) []int {\treturn Filter(func(y int) bool { return x != y }, l)}func Permutations(s []int) [][]int {// å¦‚æœsæ˜¯ä¸ªç©ºé›†åˆï¼Œé‚£ä¹ˆå…¶å…¨æ’åˆ—ä¸ºä¸€ä¸ªåŒ…å«ç©ºé›†åˆçš„é›†åˆï¼Œå³{Ğ¤}\tif len(s) == 0 {\t\treturn [][]int{[]int{}}\t}/* è¿™ä¸ªConcatMapæ˜¯ç²¾é«“ï¼Œå…ˆçœ‹ConcatMapçš„å¯¹è±¡ï¼Œå°±æ˜¯sï¼Œæ‰€ä»¥å¯¹æ¯ä¸ªå…ƒç´ éƒ½ä¼šæ‰§è¡Œç¬¬ä¸€ä¸ªå‡½æ•°å‚æ•° * ç¬¬ä¸€ä¸ªå‡½æ•°çš„æ„æ€æ˜¯ï¼šæ¥å—å…ƒç´ xï¼Œç„¶åæŠŠé›†åˆsä¸­çš„xå»é™¤ä»¥åå¯¹å‰©ä¸‹çš„éƒ¨åˆ†è¿›è¡Œå…¨æ’åˆ—ï¼Œ * ç„¶åå‘å¾—åˆ°çš„å…¨æ’åˆ—é›†åˆé‡Œçš„æ¯ä¸ªåˆ‡ç‰‡çš„æœ€åä¸Šæ’ä¸€ä¸ªx * å¦‚æ­¤ä¸€æ¥å°±å¾—åˆ°äº†ä»¥xä¸ºå°¾å…¶ä½™å…ƒç´ çš„ä¸€ä¸ªå…¨æ’åˆ—ä¸ºå¤´çš„é›†åˆçš„é›†åˆï¼› * å¯¹sä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½åº”ç”¨è¿™ä¸ªå‡½æ•°ç„¶åå†æ‹¼æ¥ä¸å°±å¾—åˆ°äº†æ‰€æœ‰å…ƒç´ çš„å…¨æ’åˆ— * å½“ç„¶è¿™ä¸ªå®ç°æ˜¯æ»¡å‡ºç¿”å¹¶ä¸”æœ‰bugçš„ */\treturn ConcatMap(func(x int) [][]int {\t\treturn Map(func(p []int) []int { return append(p, x) }, Permutations(Remove(x, s)))\t}, s)} æ±‚è§£å…«çš‡åfunc abs(x int) int {\tif x &lt; 0 {\t\treturn -x\t}\treturn x}func safe(k int, positions []int) bool {\tfor i, p := range positions {\t\tif p == k || abs(p-k) == i+1 {\t\t\treturn false\t\t}\t}\treturn true}func sequence(a, b int) []int {\tif a &gt; b {\t\treturn []int{}\t}\tresult := make([]int, b-a+1)\tfor i := range result {\t\tresult[i] = a + i\t}\treturn result}func positions(k, n int) [][]int {//positions: å°è¯•åœ¨å¤§å°ä¸ºnçš„æ£‹ç›˜çš„ç¬¬kè¡Œæ”¾æ£‹å­\tif k == 0 {\t\treturn [][]int{[]int{}}\t}\tconf := positions(k-1, n) /* * ç¨å¾®è§£é‡Šä¸€ä¸‹è¿™å¨æ€ªç‰©ï¼Œå…¶å®æ‡‚äº†ä»¥åå°±æ˜ç™½è¿™æ˜¯ä¸ªéå¸¸ç®€æ´çš„å›æº¯ * é¦–å…ˆçœ‹ConcatMapçš„å¯¹è±¡ï¼Œsequence(1, n)ï¼Œå…¶å®å°±æ˜¯å¯¹äºä»1..nè¿™nä¸ªä½ç½®ï¼Œå¾ªç¯ä½¿ç”¨ç¬¬ä¸€ä¸ªå‡½æ•° * å¯ä»¥å±•å¼€æˆå¯¹åº”çš„forå¾ªç¯ * ç„¶åMapçš„æ•ˆæœæ˜¯åœ¨å¯¹å¤´ä¸Šæ’ä¸Šp * Filterè¿‡æ»¤å‡ºé‚£äº›åœ¨pä¸Šæ”¾ç½®æ£‹å­ä»ç„¶å®‰å…¨çš„æƒ…å†µ(è¿™æ ·å°±ä¼šè¾¹æœç´¢è¾¹å‰ªæäº†) */\treturn ConcatMap(func(p int) [][]int {\t\treturn Map(func(ps []int) []int { return append([]int{p}, ps...) },\t\t\tFilter(func(ps []int) bool { return safe(p, ps) }, conf))\t}, sequence(1, n))}func Queen(boardSize int) [][]int {\treturn positions(boardSize, boardSize)}ä¸Goæ³›å‹ç›¸å…³å†…å®¹ï¼Œè®¡åˆ’ä¸‹ä¸€ç¯‡æ›´æ–°è¿­ä»£å™¨æ¨¡å¼" }, { "title": "è¯æ³•åˆ†æä¹‹NFA, DFA, Min-DFAä¸RE, RG", "url": "/posts/FSA_and_RE/", "categories": "ç¼–è¯‘åŸç†, è¯æ³•åˆ†æ", "tags": "è‡ªåŠ¨æœºç†è®º, Finite State Automata", "date": "2022-03-02 23:52:00 +0800", "snippet": " Computation with automata.Glossary NFA: Non-Deterministic Finite Automata éç¡®å®šæ€§çš„æœ‰é™çŠ¶æ€è‡ªåŠ¨æœº å¯¹äºNFAçš„éç¡®å®š, æœ‰ä¸¤ç§æœ‰è¶£çš„è§£é‡Š åœ¨éœ€è¦åšå‡ºä¸ç¡®å®šé€‰æ‹©çš„æ—¶å€™, NFAä¼šå¤åˆ¶è‡ªå·±å¹¶æ‰§è¡Œæ‰€æœ‰çš„æ“ä½œ, å¦‚æœæœ€ç»ˆæœ‰ä»»ä½•ä¸€å°è‡ªåŠ¨æœºåˆ°è¾¾äº†æ¥æ”¶çŠ¶æ€, é‚£ä¹ˆNFAæ¥æ”¶...", "content": " Computation with automata.Glossary NFA: Non-Deterministic Finite Automata éç¡®å®šæ€§çš„æœ‰é™çŠ¶æ€è‡ªåŠ¨æœº å¯¹äºNFAçš„éç¡®å®š, æœ‰ä¸¤ç§æœ‰è¶£çš„è§£é‡Š åœ¨éœ€è¦åšå‡ºä¸ç¡®å®šé€‰æ‹©çš„æ—¶å€™, NFAä¼šå¤åˆ¶è‡ªå·±å¹¶æ‰§è¡Œæ‰€æœ‰çš„æ“ä½œ, å¦‚æœæœ€ç»ˆæœ‰ä»»ä½•ä¸€å°è‡ªåŠ¨æœºåˆ°è¾¾äº†æ¥æ”¶çŠ¶æ€, é‚£ä¹ˆNFAæ¥æ”¶è¿™ä¸ªè¾“å…¥ åœ¨éœ€è¦åšå‡ºä¸ç¡®å®šé€‰æ‹©çš„æ—¶å€™, NFAçš„é€‰æ‹©æ€»æ˜¯æ­£ç¡®, ä¹Ÿå°±æ˜¯è¯´, åªè¦è¿™ä¸ªä¸²æ˜¯èƒ½è¢«æ¥æ”¶çš„, é‚£NFAä¸€å®šèƒ½é€‰å¯¹ DFA: Deterministic Finite Automata ç¡®å®šæ€§çš„æœ‰é™çŠ¶æ€è‡ªåŠ¨æœº Min-DFA: Minimal Deterministic Finite Automata æœ€å°çš„DFA RE: Regular Expression æ­£åˆ™è¡¨è¾¾å¼ RG: Regular Grammar æ­£åˆ™æ–‡æ³•NFA,DFA,Min-DFA,REçš„å…³ç³»ä¸€èˆ¬åœ°ï¼Œè®¤ä¸ºNFA, DFA, Min-DFA, REçš„å…³ç³»å¦‚ä¸‹graph LRA[NFA]B[DFA]D[RE]E([code for a scanner])A--Subset Construction--&gt;B--Kleene's Construction--&gt;D--Thompson's Construction--&gt;AB--DFA Minimization--&gt;BA--&gt;ED--Direct method--&gt;BDFA Minimizationæœ‰ä¸¤ç§ç®—æ³•: Brzozowski, Hopcroft.RE to NFA: Thompson Constructionå…ˆçœ‹æ­£åˆ™è¡¨è¾¾å¼çš„ç»“æ„, è¿™é‡Œå°±ä¸é‚£ä¹ˆå½¢å¼åŒ–äº†, ç”¨Haskellçš„è¯­æ³•å†™äº†=_=data RegExp = Symbol Char -- Basic Character a | Concat RegExp RegExp -- Concatenation ab | Union RegExp RegExp -- Union a+b | Star RegExp -- Kleene star a* å½“RegExpæ˜¯Symbol aæ—¶ stateDiagram-v2\tdirection LR\ts0\ts1\t[*]--&gt;s0\ts0--&gt;s1:a\ts1--&gt;[*] å½“RegExpæ˜¯Concat e1 e2æ—¶ stateDiagram-v2\tdirection LR\t%% e1--&gt;e2:Îµ\ts1--&gt;s3:Îµ\tstate e1{\t\tdirection LR\t\t[*]--&gt;s0\t\ts0--&gt;s1\t}\tstate e2{\t\tdirection LR\t\ts3--&gt;s4\t\ts4--&gt;[*]\t} æˆ–è€… stateDiagram-v2\tdirection LR s1:å…¬å…±ç»“ç‚¹ s0--&gt;s1 s1--&gt;s2\tstate e1{\t\tdirection LR\t\t[*]--&gt;s0\t}\tstate e2{\t\tdirection LR\t\ts2--&gt;[*]\t} å½“RegExpæ˜¯Union e1 e2æ—¶ stateDiagram-v2\tdirection LR\t[*]--&gt;s0\ts0--&gt;s1:Îµ\ts0--&gt;s3:Îµ\ts2--&gt;s5:Îµ\ts4--&gt;s5:Îµ\ts5--&gt;[*]\tstate e1{\t\tdirection LR\t\t\ts1--&gt;s2\t}\tstate e2{\t\tdirection LR\t\t\ts3--&gt;s4\t} å½“RegExpæ˜¯Star eæ—¶ stateDiagram-v2\tdirection LR\t[*]--&gt;s0\ts0--&gt;s1:Îµ \t\ts2--&gt;s3:Îµ\ts3--&gt;[*] s0--&gt;s3:Îµ\tstate e{\t\tdirection LR\t\ts1--&gt;s2\t\ts2--&gt;s1:Îµ\t} åšé¢˜çš„æ—¶å€™ä¸€å®šä¸è¦å›¾çœäº‹, çœç•¥æŸäº›æ­¥éª¤; ä¸¥æ ¼æŒ‰ç…§è¿™å››ä¸ªpatternæ¥, ä¼šè®©ä½ é¿å…å¾ˆå¤šéº»çƒ¦NFA to DFA: å­é›†æ„é€ æ³•å­é›†æ„é€ æ³•æœ‰ä¸¤ä¸ªé‡è¦çš„å‡½æ•° $\\text{Move}(s_i, a)$, è¿”å›ä»çŠ¶æ€$s_i$æ¥æ”¶è¾“å…¥$a$èƒ½åˆ°è¾¾çš„çŠ¶æ€é›†åˆ $\\text{FollowEpsilon}(s_i)$, è¿”å›ä»çŠ¶æ€$s_i$æ¥æ”¶$\\epsilon$èƒ½åˆ°è¾¾çš„çŠ¶æ€é›†åˆ, åŒ…æ‹¬$s_i$æœ¬èº«å’Œç»è¿‡å¤šæ¬¡ç©ºè½¬ç§»åˆ°è¾¾çš„çŠ¶æ€ç”¨è‡ªç„¶è¯­è¨€æè¿°è¿™ä¸ªç®—æ³•å°±æ˜¯: ä»NFAçš„èµ·å§‹çŠ¶æ€$n_0$æ„é€ å‡ºDFAçš„èµ·å§‹çŠ¶æ€$d_0$ $d_0 = \\text{FollowEpsilon}({n_0})$ ä»¤$D = {d_0}$ å¯¹æ‰€æœ‰$\\alpha\\in \\Sigma$, è®¡ç®—$\\text{FollowEpsilon}(\\text{Move}(d_0, \\alpha))$ å¦‚æœè¿™ä¸€æ­¥ç®—å‡ºäº†æ–°çŠ¶æ€, å°†å…¶åŠ å…¥$D$ éå†$D$, å¯¹æ¯ä¸ªçŠ¶æ€è®¡ç®—$\\text{FollowEpsilon}(\\text{Move}(d_0, \\alpha))$, ç›´åˆ°æ²¡æœ‰æ–°çŠ¶æ€äº§ç”Ÿä¸ºæ­¢ å­é›†æ„é€ æ³•ä¹Ÿæ¶‰åŠåˆ°ä¸åŠ¨ç‚¹é—®é¢˜. ç”¨ä¼ªä»£ç åˆ™æ˜¯:\\[\\begin{align*}&amp;d_0 \\leftarrow \\text{FollowEpsilon}({n_0}) \\\\&amp;D \\leftarrow \\{d_0\\} \\\\&amp;W \\leftarrow \\{d_0\\} \\\\&amp;\\text{while }(W \\ne \\emptyset)\\ \\{ \\\\ &amp;\\quad\\text{ä»}W\\text{é‡Œéšä¾¿é€‰æ‹©å¹¶åˆ é™¤ä¸€ä¸ªå…ƒç´ }s\\\\ &amp;\\quad\\text{for each } \\alpha \\in \\Sigma\\ \\{ \\\\ &amp;\\quad\\quad t \\leftarrow \\text{FollowEpsilon}(\\text{Move}(s, a))\\\\ &amp;\\quad\\quad T[s, \\alpha]\\leftarrow t \\\\ &amp;\\quad\\quad \\text{if }(t \\notin D) \\text{ then \\{}\\\\ &amp;\\quad\\quad\\quad \\text{å‘}D\\text{é‡Œæ·»åŠ }t\\\\ &amp;\\quad\\quad\\quad \\text{å‘}W\\text{é‡Œæ·»åŠ }t\\\\ &amp;\\quad\\quad\\}\\\\ &amp;\\quad\\}\\\\&amp;\\}\\end{align*}\\]å®¹æ˜“çŸ¥é“, å­é›†æ„é€ æ³•æœ¬è´¨ä¸Šå°±æ˜¯åˆå¹¶äº†ä¸åŒçŠ¶æ€çš„ç›¸åŒå‰ç¼€, å› ä¸ºåœ¨DFAé‡Œçš„æ¯ä¸ªçŠ¶æ€éƒ½æ˜¯ç”±NFAé‡Œçš„ä¸€ä¸ªçŠ¶æ€$s_i$ç»è¿‡ç©ºä¸²æˆ–ä¸€ä¸ªå­—æ¯$\\alpha$è¿ç§»è¿‡æ¥çš„.DFA to Minimal DFAçŠ¶æ€æœºé‡Œå¯èƒ½å­˜åœ¨å†—ä½™çš„çŠ¶æ€, ä¹Ÿæ˜¯è¯´æœ‰å¤šä¸ªçŠ¶æ€æ— æ³•æ‰¾åˆ°ä¸€ä¸ªè¾“å…¥ä¸²åŒºåˆ†å®ƒä»¬, å½¢å¼åŒ–çš„æè¿°æ˜¯:\\[s_i\\text{å’Œ}s_j\\text{æ˜¯ç­‰ä»·çŠ¶æ€} \\Leftrightarrow \\forall c\\in \\Sigma, T(s_i, c) = T(s_j, c) \\land \\text{Path}(s_0, s_i) = \\text{Path}(s_0, s_j)\\]Brzozowskiâ€™s algorithmæ ¸å¿ƒæƒ³æ³•: æ—¢ç„¶å­é›†æ„é€ æ³•èƒ½åˆå¹¶ç›¸åŒå‰ç¼€çš„çŠ¶æ€, é‚£æˆ‘èƒ½ä¸èƒ½å†åˆ©ç”¨å­é›†æ„é€ æ³•åˆå¹¶å†—ä½™çŠ¶æ€å‘¢? å†—ä½™å°±æ˜¯é‚£äº›å‰ç¼€ç›¸åŒå’Œåç¼€ç›¸åŒçš„çŠ¶æ€, é‚£ä¹ˆæˆ‘æŠŠçŠ¶æ€æœºç¿»è¿‡æ¥åšä¸€æ¬¡å­é›†æ„é€ æ³•ä¸å°±èƒ½åˆå¹¶åç¼€, å†ç¿»è¿‡æ¥åšä¸€æ¬¡å­é›†æ„é€ æ³•ä¸å°±æŠŠå‰ç¼€ä¹Ÿåˆå¹¶äº†.åŸºäºä¸Šé¢è¿™ä¸ªæƒ³æ³•, Brzozowskiè®¾è®¡äº†å¦‚ä¸‹çš„ç®—æ³•è¿›è¡ŒDFAçš„æœ€å°åŒ–. å°†NFAç¿»è½¬è¿‡æ¥, å¾—åˆ°NFAâ€™ å¯¹NFAâ€™æ‰§è¡Œå­é›†æ„é€ æ³•å¾—åˆ°DFAâ€™, æ­¤æ—¶å®Œæˆäº†åç¼€åˆå¹¶, ä½†è¿™ä¸ªæ—¶å€™è‡ªåŠ¨æœºæ˜¯åçš„ å°†DFAâ€™ç¿»è½¬è¿‡æ¥å¾—åˆ°NFAâ€™â€™, å¯¹NFAâ€™â€˜è¿›è¡Œå­é›†æ„é€ æ³•, å°±å®Œæˆäº†å‰ç¼€çš„åˆå¹¶, å¹¶ä¸”è‡ªåŠ¨æœºä¹Ÿç¿»å›æ­£å‘çš„äº†ç¿»è½¬è‡ªåŠ¨æœºçš„æ–¹æ³•: å°†åŸè‡ªåŠ¨æœºçš„è¾¹ç¿»è½¬, åŸè‡ªåŠ¨æœºçš„èµ·å§‹çŠ¶æ€æˆä¸ºç»ˆæ­¢çŠ¶æ€, åŸè‡ªåŠ¨æœºçš„ç»ˆæ­¢çŠ¶æ€æˆä¸ºèµ·å§‹çŠ¶æ€, å¦‚æœåŸè‡ªåŠ¨æœºæœ‰å¤šä¸ªç»ˆæ­¢çŠ¶æ€é‚£å°±æ–°å¢ä¸€ä¸ªçŠ¶æ€$s_e$, æ‰€æœ‰åŸç»ˆæ­¢çŠ¶æ€é€šè¿‡$\\epsilon$è½¬ç§»åˆ°$s_e$å³å¯ç»§ç»­ç¿»è½¬.Hopcroftâ€™s algorithmæ ¸å¿ƒæƒ³æ³•: Hopcroftçš„æƒ³æ³•æ›´ç›´æ¥, åŸºæœ¬çš„ideaå°±æ˜¯: æœ€å°åŒ–DFAä¸å°±æ˜¯æŠŠç­‰ä»·çš„çŠ¶æ€åˆ’åˆ†åˆ°ä¸€èµ·, é‚£ä¸å°±æ˜¯æ‰¾åŸçŠ¶æ€æœºé‡Œçš„ä¸€ä¸ªåˆ’åˆ†, æŠŠç­‰ä»·çš„çŠ¶æ€æ”¾åˆ°ä¸€èµ·, åˆ’åˆ†çš„æ¯ä¸ªç»„å†…çš„çŠ¶æ€ç›¸äº’ä¸å¯åŒºåˆ†, ç„¶åç”¨è¿™ä¸ªåˆ’åˆ†ç»„æˆæ–°çš„è‡ªåŠ¨æœº.æˆ‘ä»¬å¸Œæœ›è¿™ä¸ªåˆ’åˆ†åº”è¯¥æœ‰ä»€ä¹ˆæ€§è´¨æ‰èƒ½ä¿è¯DFAæ˜¯æœ€å°çš„å‘¢? å‡å®šæœ€åçš„åˆ’åˆ†æ˜¯$P={p_0, p_1, p_2, \\dots p_n}$, $P$åº”è¯¥æœ‰è¿™æ ·çš„æ€§è´¨: å¦‚æœ$d_i, d_j \\in p_s$å¹¶ä¸”å¦‚æœæœ‰$c$ä½¿å¾—$d_i\\to d_x, d_j\\to d_y$, é‚£ä¹ˆ$d_x, d_y\\in p_t$ å¦‚æœ$d_i, d_j \\in p_s$å¹¶ä¸”$d_i\\in F$, é‚£ä¹ˆ$d_j\\in F$($F$æ˜¯æ¥æ”¶çŠ¶æ€é›†åˆ)å…·ä½“çš„è¿ç®—è¿‡ç¨‹: å…ˆä¹è§‚åœ°å°†æ‰€æœ‰çŠ¶æ€åˆ’åˆ†ä¸ºä¸¤ä¸ªç»„: æ¥æ”¶çŠ¶æ€ç»„å’Œå…¶ä»–çŠ¶æ€ç»„, (è¿™æ˜¯å› ä¸ºæˆ‘ä»¬å¸Œæœ›æœ€ç»ˆå¾—åˆ°çš„åˆ’åˆ†ç»„æ•°æœ€å°‘) ä»å½“å‰åˆ’åˆ†ä¸­ä»»æ„é€‰å–ä¸€ä¸ªçŠ¶æ€ç»„, æ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸€ä¸ªå­—æ¯$c$ä½¿å¾—ç»„å†…çš„çŠ¶æ€è¿ç§»åˆ°ä¸åŒçš„ç»„å†…, å¦‚æœå­˜åœ¨é‚£å°±æŒ‰ç…§è¿™äº›è¿ç§»å°†è¯¥ç»„è¿›è¡Œåˆ’åˆ†, ä½¿å¾—åˆ’åˆ†åçš„ä¸€ä¸ªçŠ¶æ€ç»„å†…çš„æ¯ä¸ªçŠ¶æ€åœ¨å­—æ¯$c$ä¸‹éƒ½è¿ç§»åˆ°åŒä¸€ä¸ªç»„å†…. é‡å¤æ‰§è¡Œè¯¥æ­¥éª¤ç›´åˆ°æ— æ³•æ ¹æ®æŸä¸ªå­—æ¯å¯¹ä»»ä½•ä¸€ä¸ªç»„è¿›è¡Œåˆ†å‰²ä¸ºæ­¢.ä¼ªä»£ç :\\[\\begin{align*}&amp;worklist \\leftarrow \\{F, \\{D-F\\}\\} \\\\&amp;partition \\leftarrow \\{F, \\{D-F\\}\\} \\\\&amp;\\text{while }(worklist \\ne \\emptyset) \\text{ \\{} \\\\&amp;\\quad \\text{ä»}worklist\\text{ä¸­é€‰å–å¹¶ç§»é™¤ä¸€ä¸ªçŠ¶æ€ç»„}S \\\\&amp;\\quad \\text{for each } \\alpha \\in \\Sigma \\text{ \\{} \\\\&amp;\\quad \\quad image \\leftarrow \\{x \\vert \\delta (x, \\alpha) \\in S \\} \\\\&amp;\\quad \\quad \\text{for each } q \\in partition \\text{ that has a state in image \\{} \\\\&amp;\\quad \\quad \\quad q_1 \\leftarrow q \\cap image \\\\&amp;\\quad \\quad \\quad q_2 \\leftarrow q - q_1 \\\\&amp;\\quad \\quad \\quad \\text{if } q_2 \\ne \\emptyset \\text{ \\{} \\\\&amp;\\quad \\quad \\quad \\quad \\text{ä»}partition\\text{ä¸­ç§»é™¤}q \\\\&amp;\\quad \\quad \\quad \\quad partition \\leftarrow partition \\cup q_1 \\cup q_2 \\\\&amp;\\quad \\quad \\quad \\quad \\text{if } q \\in worklist \\text{ \\{} \\\\&amp;\\quad \\quad \\quad \\quad \\quad \\text{ä»}worklist\\text{ä¸­ç§»é™¤}q \\\\&amp;\\quad \\quad \\quad \\quad \\quad worklist \\leftarrow worklist \\cup q_1 \\cup q_2 \\\\&amp;\\quad \\quad \\quad \\quad \\text{else } \\text{if } \\vert q_1 \\vert \\le \\vert q_2 \\vert \\text{ \\{} \\\\&amp;\\quad \\quad \\quad \\quad \\quad worklist \\leftarrow worklist \\cup q_1 \\\\&amp;\\quad \\quad \\quad \\quad \\text{else } \\\\&amp;\\quad \\quad \\quad \\quad \\quad worklist \\leftarrow worklist \\cup q_2 \\\\&amp;\\quad \\quad \\quad \\quad \\} \\\\&amp;\\quad \\quad \\quad \\quad \\text{if } s = q \\text{ \\{} \\\\&amp;\\quad \\quad \\quad \\quad \\quad break; \\\\&amp;\\quad \\quad \\quad \\quad \\} \\\\&amp;\\quad \\quad \\quad \\} \\\\&amp;\\quad \\quad \\} \\\\&amp;\\quad \\} \\\\&amp;\\} \\\\\\end{align*}\\]DFA to RE: Kleeneâ€™s constructionå®šç†: å¦‚æœ$L=L(A)$æ˜¯æŸDFA $A$çš„è¯­è¨€, é‚£ä¹ˆå­˜åœ¨æ­£åˆ™è¡¨è¾¾å¼$R$æ»¡è¶³$L=L(R)$è¿›è¡Œè½¬æ¢çš„åŸºæœ¬idea: $R_{ij} = R_{ij}^{ä¸ç»è¿‡k}+R_{ik}^{ä¸ç»è¿‡k}(R_{kk}^{ä¸ç»è¿‡k})^*R_{kj}^{ä¸ç»è¿‡k}$ å®šç†åŠè¯æ˜: å¯¹DFA $A$çš„çŠ¶æ€ç¼–å·, ä»¤1ä¸ºå¼€å§‹çŠ¶æ€, å³\\[A=(\\{1, 2, \\dots, n\\}, \\Sigma, \\delta, 1, F)\\] è®¾æ­£åˆ™è¡¨è¾¾å¼$R_{ik}^{(k)}$è¡¨ç¤ºä»$i$åˆ°$j$ä½†ä¸­é—´èŠ‚ç‚¹æ ‡å·ä¸è¶…è¿‡$k$å…¨éƒ¨è·¯å¾„çš„å­—ç¬¦ä¸²é›†åˆ\\[R_{ij}^{(k)} = \\{ x | \\hat \\delta(i, x) = j, xç»è¿‡çš„çŠ¶æ€é™¤ä¸¤ç«¯å¤–æ ‡å·ä¸è¶…è¿‡k\\}\\] é‚£ä¹ˆä¸$A=({1, 2, \\dots, n}, \\Sigma, \\delta, 1, F)$ç­‰ä»·çš„æ­£åˆ™è¡¨è¾¾å¼ä¸º\\[\\bigcup_{j\\in F}R_{1j}^{(n)}\\] ä¸”é€’å½’å¼ä¸º\\[R_{ij}^{(k)} = R_{ij}^{(k-1)} + R_{ik}^{(k-1)}(R_{kk}^{(k-1)})^*R_{kj}^{(k-1)}\\]\\[R_ij^{(0)} = \\begin{cases} \\{\\alpha | \\delta(q_i, \\alpha) = q_j\\} &amp; i\\ne j \\\\ \\{\\alpha | \\delta(q_i, \\alpha) = q_j\\} \\cup \\{\\epsilon\\} &amp; i = j \\\\ \\end{cases}\\] Base case: å½“$i\\ne j, k = 0$æ—¶, å³$i$åˆ°$j$æ²¡ç»è¿‡ä»»ä½•ä¸­é—´ç»“ç‚¹ æ²¡æœ‰$i$åˆ°$j$çš„çŠ¶æ€è½¬ç§» graph LRi((i))j((j)) $R_{ij}^{(0)}=\\emptyset$ æœ‰ä¸€ä¸ª$i$åˆ°$j$çš„çŠ¶æ€è½¬ç§» graph LRi((i))j((j))i--a--&gt;j $R_{ij}^{(0)}=a$ æœ‰å¤šä¸ª$i$åˆ°$j$çš„çŠ¶æ€è½¬ç§» graph LRi((i))j((j))i--a--&gt;ji--b--&gt;ji--c--&gt;j $R_{ij}^{(0)}=a+b+c$ å½“$i = j, k = 0$æ—¶, å³ä»$i$åˆ°è‡ªèº«æ²¡ç»è¿‡ä»»ä½•ä¸­é—´ç»“ç‚¹ çŠ¶æ€$i$æ²¡æœ‰åˆ°è‡ªå·±çš„è½¬ç§» graph LRi((i)) $R_{ii}^{(0)} = \\varepsilon$ çŠ¶æ€$i$æœ‰ä¸€ä¸ªåˆ°è‡ªèº«çš„è½¬ç§» graph LRi((i))i--a--&gt;i $R_{ii}^{(0)} = a + \\varepsilon$ çŠ¶æ€$i$æœ‰å¤šä¸ªåˆ°è‡ªèº«çš„è½¬ç§» graph LRi((i))i--a--&gt;ii--b--&gt;ii--c--&gt;i $R_{ii}^{(0)} = a + b + c \\varepsilon$ " }, { "title": "å¸¸ç”¨ç½‘ç«™åˆ†ç±»æ”¶è—", "url": "/posts/website_archive/", "categories": "ç½‘ç«™åˆ†ç±»æ”¶è—", "tags": "", "date": "2022-02-26 00:00:00 +0800", "snippet": " Frequently use websiteèµ„æºç±» Google Scholar IEEE Xplore ACM Digital Library IACRâ€™s ePrint archive DBLP arXiv CiteSeerX JSTOR SpringerLink Semantic Scholar Libgen SciHubå¤§ç‰›åšå®¢ åŒ…äº‘å²—çš„åšå®¢ ç¾å›¢æŠ€æœ¯...", "content": " Frequently use websiteèµ„æºç±» Google Scholar IEEE Xplore ACM Digital Library IACRâ€™s ePrint archive DBLP arXiv CiteSeerX JSTOR SpringerLink Semantic Scholar Libgen SciHubå¤§ç‰›åšå®¢ åŒ…äº‘å²—çš„åšå®¢ ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ Keep Coding Tech Explorer, æ•°æ®åº“, LinuxC å‡ç¥é•¿è€ é˜®ä¸€å³° JRâ€™s Blog Mthli JYYçš„WIKI ç„ç®€å› Kaito, ä¸­é—´ä»¶, åˆ†å¸ƒå¼ç³»ç»Ÿçš„è®²è§£éå¸¸ä¸é”™Goè¯­è¨€ Goè®¾è®¡æ¨¡å¼ä¸Webå¼€å‘ç­‰ Go Wiki Goè¯­è¨€é«˜æ€§èƒ½ç¼–ç¨‹ èœåˆš(Golangç³»åˆ—)Javaè¯­è¨€ BaeldungWSL WSLè®¾ç½®é™æ€IP WSLé‡Œä½¿ç”¨nvimå¦‚ä½•å…±äº«å‰ªè´´æ¿é—®é¢˜å…¬å¼€è¯¾ åæ ¡å…¬å¼€è¯¾ç¨‹è¯„ä»·ç½‘ å—å¤§SICP å—å¤§ICS PA CS4160 å½¢å¼åŒ–éªŒè¯ COMS W3157 Programming Language and Translators å—å¤§é™æ€åˆ†æ CMUé™æ€åˆ†æ CS144 Introduction to Computer Networking JYYè’‹ç¥OS å›½ç§‘å¤§é™ˆç«‹å‰è€å¸ˆç¨‹åºåˆ†æ ç†Šè‹±é£è½¯ä»¶åˆ†ææŠ€æœ¯è§†é¢‘ ç†Šè‹±é£è½¯ä»¶åˆ†ææŠ€æœ¯Slides æ¢çº¢ç‘¾ç¨‹åºè®¾è®¡è¯­è¨€çš„å½¢å¼è¯­ä¹‰ Stanford CS242 CS3520 Utah Cornell CS3110 MIT 6.824å…è´¹ä¹¦ç± HTDP Crafting Interpreter ä¸€ä»½ä¸å¤ªç®€çŸ­çš„LATEX2eä»‹ç» OCaml Programming: Correct + Efficient + Beautiful Real World OCaml How To Ask Question Operating System: Three Easy Pieces Jeff Ericksonçš„Algorithms How to Read a Paperå·¥å…·ç½‘ç«™ GodBolt æ•°æ®ç¥å¨ PasteBin ä»£ç æŸ¥é‡ï¼ŒMOSS æ­£åˆ™è¡¨è¾¾å¼è½¬éç¡®å®šæ€§æœ‰ç©·è‡ªåŠ¨æœº æ­£åˆ™è¡¨è¾¾å¼é“é“å›¾ è‡ªåŠ¨æœºæ¨¡æ‹Ÿå™¨ Regex Debugger Overleaf åœ¨çº¿LaTexç¼–è¾‘å™¨ Tables Generator è¡¨æ ¼ç”Ÿæˆå™¨ QuillBot Paraphrase å·¥å…· Detexify è¯†åˆ«æ‰‹å†™ç¬¦å·è¾“å‡ºLaTexæŒ‡ä»¤ Connected Papers è®ºæ–‡å…³è”å¯è§†åŒ– Academic Phrase Bank ä¸€äº›æ¨¡æ¿å¥ doi2bib æŠŠDOIè½¬æˆBibTex Linggle è¯æ±‡æ­é…åˆ†æ Shapecatcher Unicodeæ‰‹å†™è¯†åˆ« Try It Online å„ç§ç¼–ç¨‹è¯­è¨€åœ¨çº¿è¿è¡ŒMISC å¦‚ä½•åœ¨Markdowné‡Œä½¿ç”¨PlantUMLç”»å›¾ Tmux ä½¿ç”¨æ•™ç¨‹ ä¸€å¹´æˆä¸ºEmacsé«˜æ‰‹ Mirage OS(Unikernel) JYYå¼€å‘çš„ä»£ç æŸ¥é‡å‰ä»–è°± å¤•å‡ª" }, { "title": "é€šç”¨çš„Memorizationæ–¹æ³•", "url": "/posts/memorize/", "categories": "SICP", "tags": "python, lisp", "date": "2021-04-23 16:58:00 +0800", "snippet": " æœ€è¿‘çœ‹åˆ°äº†ä¸€ä¸ªschemeå®ç°çš„é€šç”¨è®°å¿†åŒ–æ–¹æ³•ï¼Œä½†å…¶ä»£ç æ™¦æ¶©éš¾æ‡‚ï¼Œæ•´ç†äº†ä¸€ä»½pythonç‰ˆæœ¬ï¼Œå‘ç°è¿œæ¯”lispç®€å•æ˜äº†ï¼Œé‚å†™ä¸€ç¯‡åšå®¢ä¿ç•™ä¹‹ã€‚1. Introè®°å¿†æ³•(Memorization)ï¼Œæˆ–ç§°è¡¨æ ¼æ³•(tabulation)æ˜¯ä¸€ç§å¸¸ç”¨çš„ç¼“å­˜æŠ€æœ¯ï¼Œé‡‡ç”¨è¿™ç§æŠ€æœ¯çš„å‡½æ•°å°†å‰é¢å·²ç»ç®—å‡ºçš„ä¸€äº›å€¼è®°å½•åœ¨ä¸€ä¸ªå±€éƒ¨çš„å­—å…¸é‡Œï¼Œè¿™ç§æ‰‹æ®µèƒ½å¤Ÿå¤§å¤§åŠ å¿«ä¸€äº›å‡½æ•°çš„æ•ˆç‡ã€‚é‡‡ç”¨è®°å¿†æ³•çš„è¿‡ç¨‹ç»´æŠ¤ç€ä¸€ä¸ªå­—å…¸ï¼Œå…¶ä¸­ä¿å­˜ç€...", "content": " æœ€è¿‘çœ‹åˆ°äº†ä¸€ä¸ªschemeå®ç°çš„é€šç”¨è®°å¿†åŒ–æ–¹æ³•ï¼Œä½†å…¶ä»£ç æ™¦æ¶©éš¾æ‡‚ï¼Œæ•´ç†äº†ä¸€ä»½pythonç‰ˆæœ¬ï¼Œå‘ç°è¿œæ¯”lispç®€å•æ˜äº†ï¼Œé‚å†™ä¸€ç¯‡åšå®¢ä¿ç•™ä¹‹ã€‚1. Introè®°å¿†æ³•(Memorization)ï¼Œæˆ–ç§°è¡¨æ ¼æ³•(tabulation)æ˜¯ä¸€ç§å¸¸ç”¨çš„ç¼“å­˜æŠ€æœ¯ï¼Œé‡‡ç”¨è¿™ç§æŠ€æœ¯çš„å‡½æ•°å°†å‰é¢å·²ç»ç®—å‡ºçš„ä¸€äº›å€¼è®°å½•åœ¨ä¸€ä¸ªå±€éƒ¨çš„å­—å…¸é‡Œï¼Œè¿™ç§æ‰‹æ®µèƒ½å¤Ÿå¤§å¤§åŠ å¿«ä¸€äº›å‡½æ•°çš„æ•ˆç‡ã€‚é‡‡ç”¨è®°å¿†æ³•çš„è¿‡ç¨‹ç»´æŠ¤ç€ä¸€ä¸ªå­—å…¸ï¼Œå…¶ä¸­ä¿å­˜ç€å‰é¢å·²ç»åšè¿‡çš„è°ƒç”¨æ±‚å‡ºçš„å€¼ï¼Œä»¥äº§ç”Ÿè¿™äº›å€¼çš„å¯¹åº”å‚æ•°ä½œä¸ºKeyã€‚å½“è¿™ç§è¿‡ç¨‹è¢«è°ƒç”¨æ—¶ï¼Œå®ƒé¦–å…ˆæ£€æŸ¥æœ‰å…³çš„å­—å…¸ï¼Œçœ‹çœ‹ç›¸åº”çš„å€¼æ˜¯å¦å·²ç»åœ¨é‚£é‡Œï¼Œå¦‚æœæ‰¾åˆ°äº†ï¼Œå°±ç›´æ¥è¿”å›è¿™ä¸ªå€¼; å¦åˆ™å°±ä»¥æ­£å¸¸çš„æ–¹å¼è®¡ç®—å‡ºç›¸åº”çš„å€¼ï¼Œå¹¶å°†è¿™ä¸ªå€¼ä¿å­˜åˆ°è¡¨æ ¼é‡Œã€‚ä¸¾ä¸€ä¸ªç»å…¸çš„ä¾‹å­:memo = {0: 0, 1: 1}# ä¸å¸¦è®°å¿†çš„ç‰ˆæœ¬def fib(n): if n == 0: return 0 if n == 1: return 1 return fib(n - 1) + fib(n - 2)## fib(30) time elapsed: 0.2773573199999999# å¸¦è®°å¿†çš„ç‰ˆæœ¬def fib_memo(n): if n in memo: return memo[n] else: memo[n] = fib(n - 1) + fib(n - 2) return memo[n]## fib_memo(30) time elapsed: 4.91160000000157e-05å®¹æ˜“çŸ¥é“ä¸å¸¦è®°å¿†çš„å‡½æ•°è®¡ç®—è¾ƒå¸¦è®°å¿†çš„å‡½æ•°æ…¢å¾ˆå¤šã€‚è®°å¿†æ³•å¾ˆä¸é”™ï¼Œä½†æ˜¯é‡‡ç”¨ä¸Šè¿°è®°å¿†æ³•å¸¦æ¥çš„ç¼ºç‚¹æœ‰: éœ€è¦ä¿®æ”¹å‡½æ•°çš„å…·ä½“å®ç° è¦å¼•å…¥ä¸€ä¸ªå…¨å±€å˜é‡è¿›è¡Œè®°å¿† è®°å¿†çš„æ–¹æ³•ä¸é€šç”¨2. Generalizeé’ˆå¯¹ä»¥ä¸Šä¸‰ä¸ªç¼ºç‚¹ï¼Œæˆ‘ä»¬æ¥é€ä¸€è§£å†³ã€‚2.1 æ¶ˆé™¤å…¨å±€å˜é‡è¿˜æ˜¯ä»¥æ–æ³¢é‚£å¥‘ä¸ºä¾‹ï¼Œmemoçš„ç›®çš„æ˜¯è®°å½•å‡½æ•°è¿è¡Œçš„ç»“æœï¼Œè¦åšåˆ°è¿™ä¸€ç‚¹ä¸éœ€è¦ä½¿ç”¨å…¨å±€å˜é‡ï¼Œåªéœ€è¦è®©æˆ‘ä»¬çš„å‡½æ•°å¸¦ä¸Šè‡ªç”±å˜é‡å³å¯ã€‚def get_fib(): memo = {0: 0, 1: 1} def inner(n): if n in memo: return memo[n] else: memo[n] = inner(n - 1) + inner(n - 2) return memo[n] return innerfib = get_fib()## fib(30) time elapsed: 4.8156000000076915e-052.2 è®©è®°å¿†æ–¹æ³•é€šç”¨é€šè¿‡å‰é¢çš„ä¿®æ”¹ï¼Œæˆ‘ä»¬æ¶ˆé™¤äº†å…¨å±€å˜é‡ã€‚è§‚å¯Ÿåˆ°innerä¸­å¯¹memoè¿›è¡Œäº†ä¿®æ”¹çš„åªæœ‰ä¸€è¡Œmemo[n] = inner(n - 1) + inner(n - 2)ï¼Œè¿™é‡Œå¯ä»¥æŠ½è±¡æˆä¸ºä¸€ä¸ªè®¡ç®—è¿‡ç¨‹fï¼Œfå¯ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚æ ¹æ®è¿™ä¸ªideaæˆ‘ä»¬å¾—åˆ°äº†ä»¥ä¸‹ä»£ç ï¼šdef memorize(f):\tmemo = {}\tdef inner(n):\t\tif n not in memo:\t\t\tmemo[n] = f(n)\t\treturn memo[n]\treturn inner\tfib_memo_lambda = memorize(lambda x: 0 if x == 0 else 1 if x == 1 else fib_memo_lambda(x - 1)+fib_memo_lambda(x - 2))## fib_memo_lambda(30) time elapsed: 9.787600000010777e-05def fib(n): if n == 0: return 0 if n == 1: return 1 return fib(n - 1) + fib(n - 2)è¿™æ ·æˆ‘ä»¬æŠŠè®°å¿†çš„è¿‡ç¨‹æŠ½è±¡å‡ºæ¥äº†ï¼Œmemorizeå°±æˆä¸ºäº†ä¸€ä¸ªé€šç”¨çš„è®°å¿†æ–¹æ³•ã€‚ä½†æ˜¯è¿™ä¸ªå®ç°æˆ‘ä»¬è¿˜æ˜¯éœ€è¦ä¿®æ”¹fibåŸæ¥çš„å®ç°ï¼Œå¹¶ä¸”fib_memoè¿™ç§åˆ©ç”¨lambdaè¡¨è¾¾å¼çš„æ–¹æ³•ä»¤äººè´¹è§£ï¼ˆIt is actually a little tricky,å…·ä½“trickyåœ¨å“ªå„¿ï¼Œè¯·çœ‹æ€è€ƒé¢˜ï¼‰ï¼Œèƒ½ä¸èƒ½å†ä¼˜åŒ–ä¸€ä¸‹ï¼Ÿ æ€è€ƒé¢˜: æŠŠfib_memoç›´æ¥å®šä¹‰ä¸ºmemorize(fib)æ˜¯å¦èƒ½æé«˜è®¡ç®—æ•ˆç‡ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ2.3 æ— éœ€æ”¹åŠ¨åŸå‡½æ•°å®ç°è®°å¿†æˆ‘ä»¬åªéœ€è¦åˆ©ç”¨Pythonä¸­çš„è£…é¥°å™¨(Decorator),å°±èƒ½è¾¾åˆ°ä¸æ”¹åŠ¨å‡½æ•°å®ç°è€Œèƒ½æå‡è®¡ç®—æ•ˆç‡çš„æ•ˆæœã€‚def memorize(f): memo = {} def inner(x): if x not in memo: memo[x] = f(x) return memo[x] return inner@memorizedef fib_memo_decorator(n): if n == 0: return 0 if n == 1: return 1 return fib_memo_decorator(n - 1) + fib_memo_decorator(n - 2)## fib_memo_decorator(30) time elapsed: 4.57430000000425e-053. æ€è€ƒé¢˜çš„ç ”ç©¶å…ˆè¯´ç»“è®º: memorize(fib)ä¸èƒ½èµ·åˆ°è®°å¿†æ•ˆæœï¼ï¼ï¼å¾ˆå¤šäººå¯èƒ½è§‰å¾—â€œä½ è¿™å†™çš„éƒ½æ˜¯å•¥ç©æ„å„¿é˜¿ï¼Œä¸€ä¼šå„¿è‡ªç”±å˜é‡ä¸€ä¼šå„¿lambdaä¸€ä¼šå„¿decoratorçš„ï¼Œä¼ lambdaå’Œå®šä¹‰å¥½çš„å‡½æ•°ç”±å•¥åŒºåˆ«å•Š,ä¸ºä»€ä¹ˆå®šä¹‰å¥½çš„å‡½æ•°ä¸èƒ½ç›´æ¥ä¼ å…¥memorizeè€Œè¦ç”¨decoratorå•Šã€‚â€ï¼Œåˆ«æ€¥ï¼Œæˆ‘ä»¬æ…¢æ…¢æ¥ã€‚ï¼ˆä»¥ä¸‹å†…å®¹å¯èƒ½æœ‰è¯¯ï¼Œæœ‰å¤§ä½¬å‘ç°çƒ¦è¯·æŒ‡å‡º)å…ˆç”»å‡ºmemorizeæ±‚å€¼çš„ç¯å¢ƒæ¨¡å‹ã€‚è¦åŒºåˆ†fib_memo_lambdaï¼Œdecoratorå’Œfib_memo = memorize(fib),åªéœ€è¦å°†å®é™…å‚æ•°åº”ç”¨äºä¸Šé¢è¿™ä¸ªç¯å¢ƒæ¨¡å‹ä¸­å³å¯ã€‚3.1 fib_memo_lambdaçš„æ±‚å€¼è¿‡ç¨‹def memorize(f):\tmemo = {}\tdef inner(n):\t\tif n not in memo:\t\t\tmemo[n] = f(n)\t\treturn memo[n]\treturn inner\tfib_memo_lambda = memorize(lambda x: 0 if x == 0 else 1 if x == 1 else fib_memo_lambda(x - 1) + fib_memo_lambda(x - 2))fib_memo_lambdaç»‘å®šçš„ç¯å¢ƒå¦‚ä¸‹å›¾æ‰€ç¤º:ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºfib_memo_lambdaç»‘å®šç¯å¢ƒä¸­çš„få…¶å®æ˜¯ä¸€ä¸ªunnamed lambda,è¯¥unnamed lambdaè¿ç®—æ—¶ä¼šå»é€’å½’çš„è°ƒç”¨æœ‰è®°å¿†çš„fib_memo_lambdaï¼Œè¯¥é€’å½’è°ƒç”¨å¼€é”€ä¸å¤§ï¼Œå› ä¸ºæˆ‘é€’å½’è°ƒç”¨çš„æ˜¯å¸¦è®°å¿†çš„è¿‡ç¨‹ã€‚3.2 fib_memo_lambda = memorize(fib)æ— æ•ˆçš„åŸå› å…ˆä¸Šå›¾ï¼Œfib_memo_lambda=memorize(fib)çš„ç¯å¢ƒæ¨¡å‹å¦‚ä¸‹ã€‚å¯ä»¥çœ‹åˆ°memorize(fib)è¿™é‡Œçš„unnamed lambdaé€’å½’è°ƒç”¨çš„å…¶å®æ˜¯ä¸å¸¦è®°å¿†çš„è¿‡ç¨‹fib,é‚£ä¹ˆmemorize(fib)æ¯æ¬¡è®¡ç®—ä¸€ä¸ªä¸åœ¨memoä¸­çš„å€¼çš„æ—¶å€™ï¼Œå°±ä¼šè¿›å…¥åˆ°æ— è®°å¿†çš„fibå½“ä¸­å»æ±‚å€¼ï¼Œå…¶é€Ÿåº¦è‡ªç„¶ä¹Ÿå°±æ…¢äº†ã€‚3.3 fib_memo_decoratoræœ‰æ•ˆçš„åŸå› å…ˆçœ‹è£…é¥°å™¨çš„å®šä¹‰ï¼š è£…é¥°å™¨è¯­æ³•åªæ˜¯ä¸€ç§è¯­æ³•ç³–ï¼Œä»¥ä¸‹ä¸¤ä¸ªå‡½æ•°å®šä¹‰åœ¨è¯­ä¹‰ä¸Šå®Œå…¨ç­‰ä»·: def f(...): ...f = staticmethod(f)@staticmethoddef f(...): ... PEPå¯¹decoratorçš„è§£é‡Šä¹Ÿå°±æ˜¯è¯´,ä»¥ä¸‹ä¸¤ä¸ªè¯­å¥å®Œå…¨ç­‰ä»·@memorizedef fib_memo_decorator(n):fib_memo_decorator = memorize(fib_memo_decorator)è¿™ä¸ªè¿‡ç¨‹ä¸­fib_memo_decoratorå‘ç”Ÿäº†é‡æ–°ç»‘å®šã€‚fib_memo_decoratoråœ¨åŠ è£…é¥°å™¨å‰çš„æ ·å­ï¼šå®¹æ˜“çœ‹å‡ºå°±æ˜¯ä¸ªæ™®é€šçš„é€’å½’è¿‡ç¨‹ã€‚æ‰§è¡Œfib_memo_decorator=memorize(fib_memo_decorator):è™šçº¿ä¸ºfib_memo_decoratorå‘ç”Ÿçš„ç¬¬äºŒæ¬¡ç»‘å®šã€‚å¯ä»¥çœ‹å‡ºå‘ç”ŸäºŒæ¬¡ç»‘å®šåï¼Œinnerå†…çš„fé€’å½’è°ƒç”¨çš„ä¹Ÿæ˜¯å¸¦è®°å¿†çš„è¿‡ç¨‹äº†ã€‚4. æ€»ç»“æ‡’å¾—æ€»ç»“äº†ï¼Œåº”è¯¥è®²çš„å¾ˆæ¸…æ¥šäº†_(Â´à½€`ã€ âˆ )_ã€‚" } ]
